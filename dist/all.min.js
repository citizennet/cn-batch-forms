"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){angular.module("cn.batch-forms",["schemaForm","cn.flex-form","cn.util","ui.router"])}(),function(){function e(e,t,n){function a(){console.log("vm.parent:",i.parent),i.config.idParam&&i.results.forEach(function(t,a){var s=_.assign({},n,_defineProperty({},i.config.idParam,i.originals[a].id));t.editSref=e.current.name+"("+angular.toJson(s)+")",console.log("result.editSref:",t)}),i.headerConfig={title:{main:"Batch Results"},actionConfig:{actions:[{text:"Continue Editing"},{text:"Done",handler:function(){i.config&&i.config.returnState&&e.go(i.config.returnState.name,i.config.returnState.params)}}]},noData:!0}}function s(e){console.log("submit:",e),i.parent.closeModal(),e&&e()}var i=this;i.parent=t,i.results=i.parent.results,i.originals=i.parent.models,i.config=i.parent.resultsConfig,i.displayName=i.config&&i.config.displayName||"name",i.formName=e.current.name,i.activate=a,i.submit=s,i.activate()}angular.module("cn.batch-forms").controller("BatchResults",e),e.$inject=["$state","parent","$stateParams"]}(),function(){function e(e){e.registerField({condition:function(e){return e.type===n},handler:function(e){},type:n,templateUrl:a})}function t(e){e.put(a,'        <div class="checkbox cn-dirty-check {{form.htmlClass}}">          <input type="checkbox"                 ng-model="$$value$$"                 ng-model-options="form.ngModelOptions"                 sf-changed="form"                 ng-disabled="form.readonly"                 name="{{form.key.slice(-1)[0]}}"/>        </div>')}angular.module("cn.batch-forms").config(e).run(t);var n="cn-dirty-check",a="cn-batch-forms/cn-dirty-check.html";e.$inject=["cnFlexFormServiceProvider"],t.$inject=["$templateCache"]}(),function(){function e(e,t,n,a,s,i,o){function r(e,t,n){if(!n.length)return e;var a=c(e,t,n);return a}function c(e,t,n){return Object.create({constructor:l,addMeta:j,addToSchema:v,clearDefaults:F,clearSchemaDefault:V,closeModal:P,createDirtyCheck:y,createBatchField:b,getChangedModels:M,getEditModeLegends:R,getModelValues:C,getSchemaDefault:g,getTitleMap:m,onFieldScope:d,processCondition:f,processForm:h,processField:p,processItems:u,processDate:w,processDefault:S,processNumber:x,processSelect:E,processToggle:$,setValue:k,showResults:D}).constructor(e,t,n)}function l(e,t,n){if(console.log("BatchForms:",e,t,n),this.instance=q,q++,this.schema=e,this.model=t,this.models=n,this.editModes={},this.fieldRegister={},this.clearDefaults(),e.forms)for(var s=e.forms.length-1;s>-1;)this.processForm(e.forms[s]),e.forms[s].form.length||e.forms.splice(s,1),--s;else this.processForm(e.form);return this.addMeta(),a.$on("schemaFormPropagateScope",this.onFieldScope.bind(this)),console.log("BatchDone:",e,t,n),this}function d(e,t){var n=t.form._key;n?this.fieldRegister[n].ngModel=t.ngModel:"__batchConfig"===t.form.key[0]&&(t.ngModel.$pristine=!1)}function h(e){this.processItems(e,"form")}function u(e){for(var t=arguments.length<=1||void 0===arguments[1]?"items":arguments[1],n=e[t].length-1;n>-1;){var a=e[t][n],s=this.processField(a);if(a.batchConfig&&s){a.htmlClass=(a.htmlClass||"")+" cn-batch-field clearfix";var i=this.createBatchField(a),o=a.key&&this.createDirtyCheck(a);e[t][n]={type:"section",htmlClass:"cn-batch-wrapper",items:o?[a,o,i]:[a,i],condition:this.processCondition(a.condition)},delete a.condition,this.fieldRegister[a.key]={field:a}}s||e[t].splice(n,1),--n}}function f(e){return e&&e.replace(/\b(model)\.(\S*)\b/g,'($1.$2 === undefined ? $1.__ogValues["$2"] : $1.$2)')}function p(n){if(n.key){if(!n.batchConfig)return!1;n._key=n.key,n.schema=n.schema||e.getSchema(n.key,this.schema.schema.properties),n.type=n.type||n.schema.type;var a=t.getFieldType(n),s=A[a];if(!s)return!1;if(_.isObject(n.batchConfig)||(n.batchConfig={}),n.batchConfig.ogValues=this.getModelValues(n),_.allEqual(n.batchConfig.ogValues)){var i='__ogValues["'+n.key+'"]',o=_.first(n.batchConfig.ogValues);e.parseExpression(i,this.model).set(o)}s.bind(this)(n)}else if(n.items){if(n.batchConfig&&n.items.forEach(function(e){e.batchConfig=_.clone(n.batchConfig)}),this.processItems(n),!n.items.length)return!1;n.batchConfig&&(_.isObject(n.batchConfig)||(n.batchConfig={}),n.batchConfig.key="component_"+_.uniqueId(),n.batchConfig.watch=[],n.items.forEach(function(e,t){var a=e.items[0];t||(n.batchConfig.editModes=a.batchConfig.editModes,n.batchConfig["default"]=a.batchConfig["default"]),n.batchConfig.watch.push({resolution:'model.__batchConfig["'+a.key+'"] = model.__batchConfig["'+n.batchConfig.key+'"]'}),e.items[2].condition="false"}))}return!0}function m(e){var t=this;return e=e||["replace"],e.map(function(e){return t.editModes[e]=!0,{name:_.capitalize(e),value:e}})}function g(e){return e||"replace"}function b(e){var t=e.batchConfig,n='__batchConfig["'+(e.key||t.key)+'"]',a={key:n,type:"radiobuttons",titleMap:this.getTitleMap(t.editModes),htmlClass:"cn-batch-options",btnClass:"btn-sm cn-no-dirty-check",watch:t.watch||[]};return 1===a.titleMap.length&&(a.condition="false"),this.addToSchema(n,{type:"string",title:"Edit Mode","default":this.getSchemaDefault(t["default"])}),t.onSelect&&a.watch.push({resolution:function(e,n){e&&t.onSelect[e](n)}}),a}function y(t){var a=this,s=n.parse(t.key),i='__dirtyCheck["'+s[0]+'"]',o=s.length>1,r="";(t.notitle||!t.schema.title)&&(r+=" notitle");var c={key:i,htmlClass:r,type:"cn-dirty-check"};return this.addToSchema(i,{type:"boolean",notitle:!0}),o||(t.watch?_.isArray(t.watch)||(t.watch=[t.watch]):t.watch=[],t.watch.push({resolution:function(n,s){if(!angular.equals(n,s)){var i=a.fieldRegister[t.key];i?i.ngModel&&i.ngModel.$dirty||i.initiated?e.parseExpression(c.key,a.model).set(!0):i.initiated=!0:console.log("noregister:",i)}}})),c}function v(e,t){var a=n.parse(e),s=this.schema.schema;a.forEach(function(e,n){n===a.length-1?(s.properties||(s.properties={}),s.properties[e]=t):""===e?(s.items||(s.items={type:"object"}),s=s.items):(s.properties||(s.properties={}),s.properties[e]||(s.properties[e]={type:"object"}),s=s.properties[e])})}function C(t){return this.models.map(function(n){return e.parseExpression(t.key,n).get()})}function M(){var t=this,n=[];return _.each(this.fieldRegister,function(a,s){var i=e.parseExpression('__dirtyCheck["'+s+'"]',t.model).get();if(i){var o=e.parseExpression('__batchConfig["'+s+'"]',t.model).get();t.models.forEach(function(a,i){n[i]||(n[i]={});var r=e.parseExpression(s,t.model).get(),c=e.parseExpression(s,n[i]),l=e.parseExpression(s,t.models[i]);t.setValue(r,c,l,o)})}}),n}function k(e,t,n,a){if("replace"===a)t.set(e);else if("append"===a){var s=n.get();_.isArray(s)?t.set(s.concat(e)):_.isString(s)&&t.set(s+" "+e.trim())}else if("prepend"===a){var s=n.get();_.isArray(s)?t.set(e.concat(s)):_.isString(s)&&t.set(e.trim()+" "+s)}else"increase"===a?t.set(n.get()+e):"decrease"===a&&t.set(n.get()-e)}function S(e){var t=e.batchConfig;t.editModes=t.editModes||["replace","prepend","append"],t["default"]=t["default"]||"append",t.onSelect={replace:function(){_.allEqual(t.ogValues)?e.placeholder=_.first(t.ogValues):e.placeholder="—"},append:function(){e.placeholder=""},prepend:function(){e.placeholder=""}}}function x(e){var t=e.batchConfig;t.editModes=t.editModes||["replace","decrease","increase"],_.allEqual(t.ogValues)?e.placeholder=_.first(t.ogValues):e.placeholder="—"}function E(t){var n=this,a=t.schema.type,s=t.batchConfig;if("array"===a)s.editModes=s.editModes||["replace","append"],s["default"]=s["default"]||"append",s.onSelect={replace:function(a){"append"!==a&&e.parseExpression(t.key,n.model).set([])},append:function(a){"replace"!==a&&e.parseExpression(t.key,n.model).set([])},remove:function(){var a=_.chain(t.batchConfig.ogValues).flatten().uniq().value();e.parseExpression(t.key,n.model).set(a)}};else{var i=_.first(s.ogValues);if(i&&_.allEqual(s.ogValues)){var o=t.titleMap||t.titleMapResolve&&this.schema.data[t.titleMapResolve];o&&(i=_.find(o,_defineProperty({},t.valueProperty||"value",i))),t.placeholder=i&&i[t.displayProperty||"name"]}t.placeholder||(t.placeholder="—")}}function w(e){var t=e.batchConfig;_.allEqual(t.ogValues)?e.placeholder=moment(_.first(t.ogValues)).format("M/DD/YYYY h:mm a"):e.placeholder="—"}function $(e){var t=e.batchConfig;_.allEqual(t.ogValues)&&(_.first(t.ogValues)==(e.onValue||!0)?e.undefinedClass="semi-transparent":e.undefinedClass="disabled semi-transparent")}function F(){this.schema.schema.required=void 0,_.each(this.schema.schema.properties,this.clearSchemaDefault.bind(this)),this.schema.schema.properties.__batchConfig={type:"object",properties:{}},this.schema.schema.properties.__dirtyCheck={type:"object",properties:{}}}function V(e){e["default"]=void 0,"object"===e.type&&e.properties?(e.required=void 0,_.each(e.properties,this.clearSchemaDefault.bind(this))):"array"===e.type&&e.items&&this.clearSchemaDefault(e.items)}function D(e,t){var n=this;this.results=e,this.resultsConfig=t,this.modal&&this.modal.close(),this.modal=o.open({controller:"BatchResults",controllerAs:"vm",templateUrl:"cn-batch-forms/batch-results.html",resolve:{parent:function(){return n}}})}function P(){this.modal.close(),this.results=[],this.resultsConfig=null}function j(){this.schema.meta='\n          <div class="well">\n            <h5>Edit Modes</h5>\n            <p>Some types of fields allow you to apply batch changes in\n            different ways:</p>\n            <dl>\n              <dt>Replace:</dt>\n              <dd>Replace all the original values\n              with the new value. <em>(If you don\'t see an <b>Edit Mode</b> option\n              for a field, this will be the default)</em></dd>\n            </dl>\n            '+this.getEditModeLegends()+"\n          </div>"}function R(){var e="";return this.editModes.prepend&&(e+="\n            <dl>\n              <dt>Prepend:</dt>\n              <dd>Add the new value to the start of the original\n              values for each item.</dd>\n            </dl>"),this.editModes.append&&(e+="\n            <dl>\n              <dt>Append:</dt>\n              <dd>Affix the new value at the end of the original\n              values for each item.</dd>\n            </dl>"),this.editModes.decrease&&(e+="\n            <dl>\n              <dt>Decrease:</dt>\n              <dd>Subtract the given value from the original\n              values for each item.</dd>\n            </dl>"),this.editModes.increase&&(e+="\n            <dl>\n              <dt>Increase:</dt>\n              <dd>Add the given value to the original\n              values for each item.</dd>\n            </dl>"),e}var q=0,A={string:S,number:x,url:"processDefault","cn-autocomplete":E,"cn-currency":x,"cn-datetimepicker":w,"cn-toggle":$};return{augmentSchema:r}}angular.module("cn.batch-forms").factory("cnBatchForms",e),e.$inject=["cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","$state","$timeout","cnModal"]}(),angular.module("cn.batch-forms").run(["$templateCache",function(e){e.put("cn-batch-forms/batch-results.html",'<div class="cn-modal">\n  <div class="modal-header clearfix">\n    <cn-flex-form-header\n      ff-header-config="vm.headerConfig"\n      ff-submit="vm.submit(handler)">\n    </cn-flex-form-header>\n  </div>\n  <div class="modal-body cn-list"\n       cn-responsive-height="80"\n       cn-responsive-break="sm"\n       cn-set-max-height>\n    <table class="table card-flex gutterless">\n      <tbody>\n      <tr ng-repeat="result in vm.results">\n        <td class="col-sm-10">\n          <h6 ng-show="result.status == 200">\n            {{result.body[vm.displayName]}}\n            <span class="text-mute">({{result.body.id}})</span>\n          </h6>\n          <h6 ng-show="result.status != 200">\n            {{vm.originals[$index][vm.displayName]}}\n            <span class="text-mute">({{vm.originals[$index].id}})</span>\n          </h6>\n          <p ng-class="{\n               \'text-danger\': result.status != 200,\n               \'text-primary\': result.status == 200\n             }">\n            <i class="fa fa-{{result.status == 200 ? \'check\' : \'times\'}}"></i>\n            {{result.status == 200 ? \'updated successfully\' : result.body.message}}\n          </p>\n        </td>\n        <td class="col-sm-2 text-center">\n          <a ng-show="result.editSref"\n             class="btn btn-sm btn-transparent"\n             ui-sref="{{result.editSref}}">\n            <i class="icn-edit"></i>\n          </a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>\n')}]);
//# sourceMappingURL=all.min.js.map
