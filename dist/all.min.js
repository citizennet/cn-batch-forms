"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}!function(){angular.module("cn.batch-forms",["schemaForm","cn.flex-form","cn.util","ui.router"])}(),function(){function e(e,t,n){function s(){console.log("vm.parent:",a.parent),a.config.idParam&&a.results.forEach(function(t,s){var i=_.assign({},n,_defineProperty({},a.config.idParam,a.originals[s].id));t.editSref=e.current.name+"("+angular.toJson(i)+")",console.log("result.editSref:",t)}),a.headerConfig={title:{main:"Batch Results"},actionConfig:{actions:[{text:"Continue Editing"},{text:"Done",handler:function(){a.config&&a.config.returnState&&e.go(a.config.returnState.name,a.config.returnState.params)}}]},noData:!0}}function i(e){console.log("submit:",e),a.parent.closeModal(),e&&e()}var a=this;a.parent=t,a.results=a.parent.results,a.originals=a.parent.models,a.config=a.parent.resultsConfig,a.displayName=a.config&&a.config.displayName||"name",a.formName=e.current.name,a.activate=s,a.submit=i,a.activate()}angular.module("cn.batch-forms").controller("BatchResults",e),e.$inject=["$state","parent","$stateParams"]}(),function(){function e(e){e.registerField({condition:function(e){return e.type===n},handler:function(e){},type:n,templateUrl:s})}function t(e){e.put(s,'        <div class="checkbox cn-dirty-check {{form.htmlClass}}">          <input type="checkbox"                 ng-model="$$value$$"                 ng-model-options="form.ngModelOptions"                 sf-changed="form"                 ng-disabled="form.readonly"                 name="{{form.key.slice(-1)[0]}}"/>        </div>')}angular.module("cn.batch-forms").config(e).run(t);var n="cn-dirty-check",s="cn-batch-forms/cn-dirty-check.html";e.$inject=["cnFlexFormServiceProvider"],t.$inject=["$templateCache"]}(),function(){function e(){function e(e){e.handler&&(n[e.type]=e.handler)}return{registerField:e,$get:t}}function t(e,t,s,i,a,r){function o(e,t,n){if(!n.length)return e;var s=c(e,t,n);return s}function c(e,t,n){return Object.create({constructor:l,addMeta:B,addToSchema:S,buildModelDefault:x,clearDefaults:q,clearSchemaDefault:I,closeModal:T,createDirtyCheck:C,createBatchField:b,getChangedModels:$,getEditModeLegends:N,getFormFromRegister:v,getModelValues:w,getSchemaDefault:g,getTitleMap:m,handleLinks:k,onFieldScope:d,processCondition:u,processForm:h,processField:p,processItems:f,processDate:P,processDefault:F,processLinkList:E,processLinks:M,processNumber:R,processSelect:j,processToggle:L,setValidation:y,setValue:V,showResults:A}).constructor(e,t,n)}function l(e,t,n){if(console.log("BatchForms:",e,t,n),this.instance=O,O++,this.schema=e,this.model=t,this.models=n,this.editModes={},this.fieldRegister={},this.clearDefaults(),e.forms)for(var s=e.forms.length-1;s>-1;)this.processForm(e.forms[s]),e.forms[s].form.length||e.forms.splice(s,1),--s;else this.processForm(e.form);return this.addMeta(),this.processLinks(),i.$on("schemaFormPropagateScope",this.onFieldScope.bind(this)),console.log("BatchDone:",e,t,n),this}function d(t,n){var s=e.getKey(n.form.key);s.startsWith("__")?"__batchConfig"===n.form.key[0]&&(n.ngModel.$pristine=!1):(this.fieldRegister[s]||(this.fieldRegister[s]={}),this.fieldRegister[s].ngModel=n.ngModel,this.fieldRegister[s].scope=n)}function h(e){this.processItems(e,"form")}function f(e){for(var t=arguments.length<=1||void 0===arguments[1]?"items":arguments[1],n=e[t].length-1;n>-1;){var s=e[t][n],i=this.processField(s);if(s.batchConfig&&i){s.htmlClass=(s.htmlClass||"")+" cn-batch-field clearfix";var a=this.createBatchField(s),r=s.key&&this.createDirtyCheck(s);e[t][n]={type:"section",htmlClass:"cn-batch-wrapper",items:r?[s,r,a]:[s,a],condition:this.processCondition(s.condition)},delete s.condition,this.fieldRegister[s.key]={field:s,dirtyCheck:r}}i||e[t].splice(n,1),--n}}function u(e){return e&&e.replace(/\b(model)\.(\S*)\b/g,'($1.$2 === undefined ? $1.__ogValues["$2"] : $1.$2)')}function p(s){if(s.key){if(!s.batchConfig)return!1;s._key=s.key,s.schema=s.schema||e.getSchema(s.key,this.schema.schema.properties),s.type=s.type||s.schema.type;var i=t.getFieldType(s),a=n[i];if(!a)return!1;if(_.isString(a)&&(a=this[a]),_.isObject(s.batchConfig)||(s.batchConfig={}),s.batchConfig.ogValues=this.getModelValues(s),_.allEqual(s.batchConfig.ogValues)){var r='__ogValues["'+s.key+'"]',o=_.first(s.batchConfig.ogValues);e.parseExpression(r,this.model).set(o)}a.bind(this)(s)}else if(s.items){if(s.batchConfig&&s.items.forEach(function(e){e.batchConfig=_.clone(s.batchConfig)}),this.processItems(s),!s.items.length)return!1;s.batchConfig&&(_.isObject(s.batchConfig)||(s.batchConfig={}),s.batchConfig.key="component_"+_.uniqueId(),s.batchConfig.watch=[],s.items.forEach(function(e,t){var n=e.items[0];t||(s.batchConfig.editModes=n.batchConfig.editModes,s.batchConfig["default"]=n.batchConfig["default"]),s.batchConfig.watch.push({resolution:'model.__batchConfig["'+n.key+'"] = model.__batchConfig["'+s.batchConfig.key+'"]'}),e.items[2].condition="false"}))}return!0}function m(e){var t=this;return e=e||["replace"],e.map(function(e){return t.editModes[e]=!0,{name:_.capitalize(e),value:e}})}function g(e){return e||"replace"}function b(e){var t=e.batchConfig,n='__batchConfig["'+(e.key||t.key)+'"]',s={key:n,type:"radiobuttons",titleMap:this.getTitleMap(t.editModes),htmlClass:"cn-batch-options",btnClass:"btn-sm cn-no-dirty-check",watch:t.watch||[]};return 1===s.titleMap.length&&(s.condition="false"),this.addToSchema(n,{type:"string",title:"Edit Mode","default":this.getSchemaDefault(t["default"])}),t.onSelect&&s.watch.push({resolution:function(e,n){e&&t.onSelect[e](n)}}),s}function y(t,n){var s=this,i=e.getKey(t.key);t.schema&&"array"===t.schema.type&&(_.isUndefined(t.schema._minItems)&&(t.schema._minItems=t.schema.minItems),t.schema.minItems=n?t.schema._minItems:0);var a=i?this.getFormFromRegister(i):[];a.forEach(function(e){e.scope&&(e.scope.options={tv4Validation:n},Object.keys(e.ngModel.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(t){e.ngModel.$setValidity(t,!0)}))}),t.items&&t.items.forEach(function(e){return s.setValidation(e,n)})}function v(e){var t=this;if(!e.includes("[]"))return[this.fieldRegister[e]];var n=function(){var n=new RegExp(e.replace("[]","\\[\\d*\\]"));return{v:_.filter(t.fieldRegister,function(e,t){return n.test(t)})}}();return"object"===("undefined"==typeof n?"undefined":_typeof(n))?n.v:void 0}function C(t){var n=this,s='__dirtyCheck["'+(t.key||batchConfig.key)+'"]',a="";(t.notitle||!t.schema.title)&&(a+=" notitle");var r={key:s,htmlClass:a,type:"cn-dirty-check",watch:[{resolution:function(e){n.setValidation(t,e),i.$broadcast("schemaFormValidate")}}]};this.addToSchema(s,{type:"boolean",notitle:!0}),t.watch?_.isArray(t.watch)||(t.watch=[t.watch]):t.watch=[];var o=this.buildModelDefault(t.key,t.schema)||{};return t.watch.push({resolution:function(i){if(!angular.equals(i,o[t._key])){var a=n.fieldRegister[t._key];a?a.ngModel&&a.ngModel.$dirty||a.initiated?e.parseExpression(s,n.model).set(!0):a.initiated=!0:console.log("noregister:",t,n.fieldRegister)}}}),r}function k(t,n){var s=this;return function(i){t.forEach(function(t){if(!n){var a=s.fieldRegister[t];if(!a.ngModel||!a.ngModel.$dirty)return}e.parseExpression('__dirtyCheck["'+t+'"]',s.model).set(i)})}}function E(e,t){var n=this;e.forEach(function(e){e.forEach(function(s){var i=n.fieldRegister[s];if(!i)return void console.error("noRegister:",s);var a=i.field,r=i.dirtyCheck,o=n.handleLinks(_.without(e,s),t);a.watch=a.watch||[],r.watch=r.watch||[],a.watch.push({resolution:function(){o(!0)}}),r.watch.push({resolution:o})})})}function M(){console.log("this.schema.batchConfig:",this.schema.batchConfig),this.schema.batchConfig&&(this.schema.batchConfig.links&&this.processLinkList(this.schema.batchConfig.links),this.schema.batchConfig.hardLinks&&this.processLinkList(this.schema.batchConfig.hardLinks,!0))}function x(e,t){if("array"===t.type){var n=function(){var n=_defineProperty({},e,[]);return t.items&&_.each(t.items.properties,function(t,s){"array"===t.type&&n[e].push(x(s,t))}),{v:n}}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}}function S(e,t){var n=s.parse(e),i=this.schema.schema;n.forEach(function(e,s){s===n.length-1?(i.properties||(i.properties={}),i.properties[e]=t):""===e?(i.items||(i.items={type:"object"}),i=i.items):(i.properties||(i.properties={}),i.properties[e]||(i.properties[e]={type:"object"}),i=i.properties[e])})}function w(t){return this.models.map(function(n){return e.parseExpression(t.key,n).get()})}function $(){var t=this,n=[];return _.each(this.fieldRegister,function(i,a){var r=e.parseExpression('__dirtyCheck["'+a+'"]',t.model).get();if(r){var o=e.parseExpression('__batchConfig["'+a+'"]',t.model).get();t.models.forEach(function(i,r){n[r]=n[r]||{};var c=s.parse(a);c.length>1&&!n[r][c[0]]&&(n[r][c[0]]=t.models[r][c[0]]);var l=e.parseExpression(a,t.models[r]).getAssignable();if(l.fullPath!==a){var d=e.parseExpression(l.fullPath,t.model).get();e.parseExpression(l.fullPath,t.models[r]).set(d)}else{var d=e.parseExpression(a,t.model).get(),h=e.parseExpression(a,n[r]),f=e.parseExpression(a,t.models[r]);t.setValue(d,h,f,o)}})}}),n}function V(e,t,n,s){if("replace"===s)t.set(e);else if("append"===s){var i=n.get();if(_.isArray(i)){var a=_([]).concat(i,e).uniq(function(e){return e.key||e}).value();t.set(a)}else _.isString(i)?t.set(i+" "+e.trim()):t.set(e)}else if("prepend"===s){var i=n.get();_.isArray(i)?t.set(e.concat(i)):_.isString(i)?t.set(e.trim()+" "+i):t.set(e)}else"increase"===s?t.set(_.add(n.get()||0,e)):"decrease"===s&&t.set(_.subtract(n.get()||0,e))}function F(t){var n=this,s=t.batchConfig;s.editModes=s.editModes||["replace","prepend","append"],s["default"]=s["default"]||"append",s.editModes.includes(s["default"])||(s["default"]=s.editModes[0]),s.onSelect={replace:function(){_.allEqual(s.ogValues)?e.parseExpression(t.key,n.model).set(_.first(s.ogValues)):t.placeholder="—"},append:function(){t.placeholder=""},prepend:function(){t.placeholder=""}}}function R(t){var n=t.batchConfig;n.editModes=n.editModes||["replace","decrease","increase"],_.allEqual(n.ogValues)?e.parseExpression(t.key,this.model).set(_.first(n.ogValues)):t.placeholder="—"}function D(e){e.items?e.items.forEach(D):e.placeholder="—"}function j(t){var n=this,s=t.schema.type,i=t.batchConfig;if("array"===s)i.editModes=i.editModes||["replace","append"],i["default"]=i["default"]||"append",_.allEqual(i.ogValues)?e.parseExpression(t.key,this.model).set(_.first(i.ogValues)):D(t),i.onSelect={replace:function(s){s&&"append"!==s&&e.parseExpression(t.key,n.model).set([])},append:function(s){"replace"!==s&&e.parseExpression(t.key,n.model).set([])},remove:function(){var s=_.chain(t.batchConfig.ogValues).flatten().uniq().value();e.parseExpression(t.key,n.model).set(s)}};else{var a=_.first(i.ogValues);a&&_.allEqual(i.ogValues)&&e.parseExpression(t.key,this.model).set(a),t.placeholder||(t.placeholder="—")}}function P(t){var n=t.batchConfig;_.allEqual(n.ogValues)?e.parseExpression(t.key,this.model).set(_.first(n.ogValues)):t.placeholder="—"}function L(t){var n=t.batchConfig;_.allEqual(n.ogValues)&&e.parseExpression(t.key,this.model).set(_.first(n.ogValues))}function q(){this.schema.schema.required=void 0,_.each(this.schema.schema.properties,this.clearSchemaDefault.bind(this)),this.schema.schema.properties.__batchConfig={type:"object",properties:{}},this.schema.schema.properties.__dirtyCheck={type:"object",properties:{}}}function I(e){e["default"]=void 0,"object"===e.type&&e.properties?(e.required=void 0,_.each(e.properties,this.clearSchemaDefault.bind(this))):"array"===e.type&&e.items&&this.clearSchemaDefault(e.items)}function A(e,t){var n=this;this.results=e,this.resultsConfig=t,this.modal&&this.modal.close(),this.modal=r.open({controller:"BatchResults",controllerAs:"vm",templateUrl:"cn-batch-forms/batch-results.html",resolve:{parent:function(){return n}}})}function T(){this.modal.close(),this.results=[],this.resultsConfig=null}function B(){this.schema.meta='\n          <div class="well">\n            <h5>Edit Modes</h5>\n            <p>Some types of fields allow you to apply batch changes in\n            different ways:</p>\n            <dl>\n              <dt>Replace:</dt>\n              <dd>Replace all the original values\n              with the new value. <em>(If you don\'t see an <b>Edit Mode</b> option\n              for a field, this will be the default)</em></dd>\n            </dl>\n            '+this.getEditModeLegends()+"\n          </div>"}function N(){var e="";return this.editModes.prepend&&(e+="\n            <dl>\n              <dt>Prepend:</dt>\n              <dd>Add the new value to the start of the original\n              values for each item.</dd>\n            </dl>"),this.editModes.append&&(e+="\n            <dl>\n              <dt>Append:</dt>\n              <dd>Affix the new value at the end of the original\n              values for each item.</dd>\n            </dl>"),this.editModes.decrease&&(e+="\n            <dl>\n              <dt>Decrease:</dt>\n              <dd>Subtract the given value from the original\n              values for each item.</dd>\n            </dl>"),this.editModes.increase&&(e+="\n            <dl>\n              <dt>Increase:</dt>\n              <dd>Add the given value to the original\n              values for each item.</dd>\n            </dl>"),e}var O=0;return{augmentSchema:o}}angular.module("cn.batch-forms").provider("cnBatchForms",e);var n={string:"processDefault",number:"processNumber",url:"processDefault",array:"processSelect","cn-autocomplete":"processSelect","cn-currency":"processNumber","cn-datetimepicker":"processDate","cn-toggle":"processToggle"};t.$inject=["cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","$timeout","cnModal"]}(),angular.module("cn.batch-forms").run(["$templateCache",function(e){e.put("cn-batch-forms/batch-results.html",'<div class="cn-modal">\n  <div class="modal-header clearfix">\n    <cn-flex-form-header\n      ff-header-config="vm.headerConfig"\n      ff-submit="vm.submit(handler)">\n    </cn-flex-form-header>\n  </div>\n  <div class="modal-body cn-list"\n       cn-responsive-height="80"\n       cn-responsive-break="sm"\n       cn-set-max-height>\n    <table class="table card-flex gutterless">\n      <tbody>\n      <tr ng-repeat="result in vm.results">\n        <td class="col-sm-10">\n          <h6 ng-show="result.status == 200">\n            {{result.body[vm.displayName]}}\n            <span class="text-mute">({{result.body.id}})</span>\n          </h6>\n          <h6 ng-show="result.status != 200">\n            {{vm.originals[$index][vm.displayName]}}\n            <span class="text-mute">({{vm.originals[$index].id}})</span>\n          </h6>\n          <p ng-class="{\n               \'text-danger\': result.status != 200,\n               \'text-primary\': result.status == 200\n             }">\n            <i class="fa fa-{{result.status == 200 ? \'check\' : \'times\'}}"></i>\n            {{result.status == 200 ? \'updated successfully\' : result.body.message}}\n          </p>\n        </td>\n        <td class="col-sm-2 text-center">\n          <a ng-show="result.editSref"\n             class="btn btn-sm btn-transparent"\n             ui-sref="{{result.editSref}}">\n            <i class="icn-edit"></i>\n          </a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>\n')}]);
//# sourceMappingURL=all.min.js.map
