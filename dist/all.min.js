"use strict";!function(){angular.module("cn.batch-forms",["schemaForm","cn.flex-form","cn.util","ui.router"])}(),function(){function e(e,t,s){function n(){console.log("vm.parent:",o.parent),o.results||s(o.cancel),o.headerConfig={title:{main:"Batch Results"},actionConfig:{actions:[{text:"Cool"}]},noData:!0}}function a(){e.go("^")}var o=this;o.parent=t,o.results=o.parent.results,o.originals=o.parent.models,o.config=o.parent.resultsConfig,o.displayName=o.config&&o.config.displayName||"name",o.activate=n,o.cancel=a,o.done=a,o.activate()}angular.module("cn.batch-forms").controller("BatchResults",e),e.$inject=["$state","parent","$timeout"]}(),function(){function e(e,t){e.registerField({condition:function(e){return e.type===s},handler:function(e){},type:s,templateUrl:n}),t.addMapping("results",{controller:"BatchResults",controllerAs:"vm",templateUrl:"cn-batch-forms/batch-results.html"})}function t(e){e.put(n,'        <div class="checkbox cn-dirty-check {{form.htmlClass}}">          <input type="checkbox"                 ng-model="$$value$$"                 ng-model-options="form.ngModelOptions"                 sf-changed="form"                 name="{{form.key.slice(-1)[0]}}"/>        </div>')}angular.module("cn.batch-forms").config(e).run(t);var s="cn-dirty-check",n="cn-batch-forms/cn-dirty-check.html";e.$inject=["cnFlexFormServiceProvider","cnFlexFormModalLoaderServiceProvider"],t.$inject=["$templateCache"]}(),function(){function e(e,t,s,n,a,o,r){function i(e,t,s){if(!s.length)return e;var n=c(e,t,s);return n}function c(e,t,s){return Object.create({constructor:l,addToSchema:g,clearDefaults:M,clearSchemaDefault:x,closeModal:$,createDirtyCheck:d,createBatchField:f,onFieldScope:h,processForm:u,processField:m,processItems:p,processDate:S,processString:C,processSelect:k,getModelValues:v,getChangedModels:y,setValue:b,showResults:F}).constructor(e,t,s)}function l(e,t,s){if(console.log("BatchForms:",e,t,s),r.resolveMapping("results",0,this),this.schema=e,this.model=t,this.models=s,this.fieldRegister={},this.clearDefaults(),e.forms)for(var a=e.forms.length-1;a>-1;)this.processForm(e.forms[a]),e.forms[a].form.length||e.forms.splice(a,1),--a;else this.processForm(e.form);return n.$on("schemaFormPropagateScope",this.onFieldScope.bind(this)),console.log("BatchDone:",e,t,s),this}function h(e,t){var s=t.form._key;s&&(this.fieldRegister[s].ngModel=t.ngModel)}function u(e){this.processItems(e,"form")}function p(e){for(var t=arguments.length<=1||void 0===arguments[1]?"items":arguments[1],s=e[t].length-1;s>-1;){var n=e[t][s],a=this.processField(n);if(n.batchConfig){n.htmlClass=(n.htmlClass||"")+" cn-batch-field";var o=this.createBatchField(n),r=this.createDirtyCheck(n);e[t][s]={type:"section",htmlClass:"cn-batch-wrapper",items:[n,r,o]},this.fieldRegister[n.key]={field:n}}a||e[t].splice(s,1),--s}}function m(s){if(s.key){if(!s.batchConfig)return!1;s._key=s.key,s.schema=s.schema||e.getSchema(s.key,this.schema.schema.properties),s.type=s.type||s.schema.type;var n=t.getFieldType(s),a=w[n];if(!a)return!1;_.isObject(s.batchConfig)||(s.batchConfig={}),s.batchConfig.ogValues=this.getModelValues(s),a.bind(this)(s)}else if(s.items&&(this.processItems(s),!s.items.length))return!1;return!0}function f(e){var t={type:"radiobuttons",titleMap:e.batchConfig.titleMap,key:"__batchConfig."+e.key};return 1===t.titleMap.length&&(t.condition="false"),this.addToSchema(e.key,"__batchConfig",{type:"string",title:"Edit Mode","default":e.batchConfig["default"]}),e.batchConfig.onSelect&&(t.watch={resolution:function(t,s){e.batchConfig.onSelect[t](s)}}),t}function d(t){var s=this,n={type:"cn-dirty-check",htmlClass:t.notitle||!t.schema.title?"notitle":"",key:"__dirtyCheck."+t.key};return this.addToSchema(t.key,"__dirtyCheck",{type:"boolean",notitle:!0}),t.watch?_.isArray(t.watch)||(t.watch=[t.watch]):t.watch=[],t.watch.push({resolution:function(a,o){if(!angular.equals(a,o)){var r=s.fieldRegister[t.key];r&&r.ngModel.$dirty&&e.parseExpression(n.key,s.model).set(!0)}}}),n}function g(e,t,n){var a=s.parse(e),o=this.schema.schema.properties[t];a.forEach(function(e,t){t===a.length-1?o.properties[e]=n:""===e?(o.items||(o.items={type:"object"}),o=o.items):(o.properties||(o.properties={}),o.properties[e]||(o.properties[e]={type:"object"}),o=o.properties[e])})}function v(t){return this.models.map(function(s){return e.parseExpression(t.key,s).get()})}function y(){var t=this,s=[];return _.each(this.fieldRegister,function(n,a){var o=e.parseExpression("__dirtyCheck."+a,t.model).get();if(console.log("key, dirty:",a,o,n),o){var r=e.parseExpression("__batchConfig."+a,t.model).get();t.models.forEach(function(n,o){s[o]||(s[o]={});var i=e.parseExpression(a,t.model).get(),c=e.parseExpression(a,s[o]),l=e.parseExpression(a,t.models[o]);t.setValue(i,c,l,r)})}}),s}function b(e,t,s,n){if("replace"===n)t.set(e);else if("push"===n){var a=s.get();_.isArray(a)?t.set(a.concat(e)):_.isString(a)&&t.set(a+" "+e.trim())}}function C(e){var t=e.batchConfig;t.titleMap=t.titleMap||[{name:"Replace",value:"replace"},{name:"Append",value:"push"}],t["default"]=t["default"]||"push",t.onSelect={replace:function(){1===_.uniq(t.ogValues).length?e.placeholder=_.first(t.ogValues):e.placeholder="—"},push:function(){e.placeholder=""}}}function k(t){var s=this,n=t.schema.type,a=t.batchConfig;"array"===n?(a.titleMap=a.titleMap||[{name:"Replace",value:"replace"},{name:"Append",value:"push"}],a["default"]=a["default"]||"push",a.onSelect={replace:function(n){"push"!==n&&e.parseExpression(t.key,s.model).set([])},push:function(n){"replace"!==n&&e.parseExpression(t.key,s.model).set([])},remove:function(){var n=_.chain(t.batchConfig.ogValues).flatten().uniq().value();e.parseExpression(t.key,s.model).set(n)}}):(a.titleMap=a.titleMap||[{name:"Replace",value:"replace"}],a["default"]=a["default"]||"replace",a.onSelect={replace:function(e){var s=_.first(a.ogValues);_.every(a.ogValues,s)?t.placeholder=s[t.displayProperty||"name"]:t.placeholder="—"}})}function S(e){console.log("field.schema:",e.schema);var t=e.batchConfig;t.titleMap=t.titleMap||[{name:"Replace",value:"replace"}],t["default"]=t["default"]||"replace",1===_.uniq(t.ogValues).length?e.placeholder=_.first(t.ogValues):e.placeholder="—"}function M(){this.schema.schema.required=[],_.each(this.schema.schema.properties,this.clearSchemaDefault.bind(this)),this.schema.schema.properties.__batchConfig={type:"object",properties:{}},this.schema.schema.properties.__dirtyCheck={type:"object",properties:{}}}function x(e){e["default"]=void 0,"object"===e.type&&e.properties?_.each(e.properties,this.clearSchemaDefault.bind(this)):"array"===e.type&&e.items&&this.clearSchemaDefault(e.items)}function F(e,t){console.log("showResults:",a.current.name),this.results=e,this.resultsConfig=t,a.go(".modal",{modal:"results",modalId:0}),this.onCloseModal=n.$on("$stateChangeStart",this.closeModal.bind(this))}function $(e,t,s){console.log("closeModal:",e,t,s),console.log("this.resultsConfig:",this.resultsConfig),this.onCloseModal();var n=this.resultsConfig;n&&n.returnState&&o(function(){return a.go(n.returnState.name,n.returnState.params)})}var w={string:C,"cn-autocomplete":k,"cn-datetimepicker":S};return{augmentSchema:i}}angular.module("cn.batch-forms").factory("cnBatchForms",e),e.$inject=["cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","$state","$timeout","cnFlexFormModalLoaderService"]}(),angular.module("cn.batch-forms").run(["$templateCache",function(e){e.put("cn-batch-forms/batch-results.html",'<div class="cn-modal">\n  <div class="modal-header cn-heading row vertical-parent">\n    <cn-flex-form-header\n      ff-header-config="vm.headerConfig"\n      ff-submit="vm.done()">\n    </cn-flex-form-header>\n  </div>\n  <div class="modal-body cn-list"\n       cn-responsive-height="80"\n       cn-responsive-break="sm"\n       cn-set-max-height>\n    <ul class="list-group gutterless">\n      <li ng-repeat="result in vm.results"\n          class="list-group-item"\n          ng-class="{\n            \'text-danger\': result.status != 200,\n            \'text-primary\': result.status == 200\n          }">\n        <div class="row">\n          <div class="col-sm-1 text-center">\n            <i class="fa fa-{{result.status == 200 ? \'check\' : \'times\'}}"></i>\n          </div>\n          <div class="col-sm-11"\n               ng-show="result.status == 200">\n            {{result.body[vm.displayName]}} ({{result.body.id}}):\n            updated successfully\n          </div>\n          <div class="col-sm-11"\n               ng-show="result.status != 200">\n            {{vm.originals[$index][vm.displayName]}} ({{vm.originals[$index].id}}):\n            {{result.body.message}}\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n')}]);
//# sourceMappingURL=all.min.js.map
