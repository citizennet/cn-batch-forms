!function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var s=i(1),r=n(s),o=i(2),a=i(3),c=n(a),l=i(4),d=n(l);angular.module("cn.batch-forms",["schemaForm","cn.flex-form","cn.util","ui.router"]).controller("BatchResults",r.default).provider("cnBatchForms",c.default).config(o.cnBatchFormsConfig).run(o.addDirtyCheckTpl).run(d.default)},function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e,t,i){"ngInject";function s(){a.config.idParam&&a.results.forEach(function(t,s){if(_.isFunction(a.config.buildEditSref))t.editSref=a.config.buildEditSref(t.body,s);else{var r=_.assign({},i,n({},a.config.idParam,a.originals[s].id));t.editSref=e.current.name+"("+angular.toJson(r)+")"}}),a.headerConfig={title:{main:"Batch Results"},actionConfig:{actions:[{text:"Continue Editing"},{text:"Done",handler:function(){a.config&&a.config.returnState&&e.go(a.config.returnState.name,a.config.returnState.params)}}]},noData:!0}}function r(e){return e.editSref&&_.inRange(e.status,200,299)}function o(e){a.parent.closeModal(),e&&e()}var a=this;a.parent=t,a.results=a.parent.results,a.originals=a.parent.models,a.config=a.parent.resultsConfig,a.displayName=a.config&&a.config.displayName||"name",a.formName=e.current.name,a.text=a.config.text,a.activate=s,a.showEdit=r,a.submit=o,a.activate()}s.$inject=["$state","parent","$stateParams"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t,i){"use strict";function n(e){"ngInject";e.registerField({condition:function(e){return e.type===r},handler:function(e){},type:r,templateUrl:o})}function s(e){"ngInject";e.put(o,'      <div class="checkbox cn-dirty-check {{form.htmlClass}}">        <input type="checkbox"               ng-model="$$value$$"               ng-model-options="form.ngModelOptions"               sf-changed="form"               ng-disabled="form.readonly"               name="{{form.key.slice(-1)[0]}}"/>      </div>')}n.$inject=["cnFlexFormServiceProvider"],s.$inject=["$templateCache"],Object.defineProperty(t,"__esModule",{value:!0}),t.cnBatchFormsConfig=n,t.addDirtyCheckTpl=s;var r="cn-dirty-check",o="cn-batch-forms/cn-dirty-check.html"},function(e,t,i){"use strict";function n(e,t,i){if(e.defaults[i]=t.default,"default"in t&&(t.default=void 0),"object"===t.type&&t.properties){"required"in t&&(t.required=void 0);for(var s in t.properties)n(e,t.properties[s],i+"."+s)}else"array"===t.type&&t.items&&n(e,t.items,i+"[]")}function s(){function e(e){e.handler&&(o[e.type]=e.handler)}return{registerField:e,$get:r}}function r(e,t,i,s,r,a,c){"ngInject";function l(e,t,i){return i.length?d(e,t,i):e}function d(e,t,i){return Object.create({constructor:h,addMeta:z,addToSchema:$,closeModal:J,createDirtyCheck:E,createBatchField:k,getChangedModels:D,getEditModeLegends:G,getFormFromRegister:x,getModelValues:V,getSchemaDefault:v,getTitleMap:b,handleLinks:w,onFieldScope:f,onReprocessField:S,processCondition:g,processDiff:u,processSchemaDiff:p,processSchema:B,processField:y,processItems:m,processDate:A,processDefault:I,processLinkList:R,processLinks:F,processNumber:q,processSelect:T,processToggle:O,registerFieldWatch:M,resetDefaults:K,restoreDefaults:W,setValidation:C,setValue:j,showResults:U}).constructor(e,t,i)}function h(t,i,n){if(this.instance=H,H++,this.schema=t,this.model=i,this.models=n,this.defaults={},this.editModes={},this.fieldRegister={},this.processSchema(),e.onProcessDiff=this.processDiff.bind(this),t.forms)for(var s=t.forms.length-1;s>-1;)this.processItems(t.forms[s].form),t.forms[s].form.length||t.forms.splice(s,1),--s;else this.processItems(t.form);return this.addMeta(),this.processLinks(),r.$on("schemaFormPropagateScope",this.onFieldScope.bind(this)),r.$on("cnFlexFormReprocessField",this.onReprocessField.bind(this)),console.info("BatchDone:",t,i,n),this}function f(e,i){var n=t.getKey(i.form.key);if(n.startsWith("__"))"__batchConfig"===i.form.key[0]&&(i.ngModel.$pristine=!1);else{this.fieldRegister[n]||(this.fieldRegister[n]={});var s=this.fieldRegister[n];s.ngModel=i.ngModel,s.scope=i,this.fieldRegister[n].field||(this.fieldRegister[n].field=i.form)}}function u(e){var t=e.params.updateSchema,i=_.filter(e.batchConfig.links,function(e){return _.startsWith(e,t)}),n=_.filter(e.batchConfig.hardLinks,function(e){return _.startsWith(e,t)});p.call(this,e.diff.schema,_.flatten(i.concat(n)))}function p(e,t){var i=this,s=_.keys(e);_.forEach(s,function(s){_.has(e[s],"properties")?p.call(i,e[s].properties,t):_.has(e[s],"items")?p.call(i,e[s].items,t):_.every(t,function(e){return!_.includes(e,s)})&&n(i,e[s],s)})}function m(e){for(var t=e.length-1;t>-1;){var i=this.processField(e[t]);if(i&&i.batchConfig){"fieldset"!==i.type&&(i.htmlClass=(i.htmlClass||"")+" cn-batch-field clearfix");var n=this.createBatchField(i),s=i.key&&this.createDirtyCheck(i);e[t]={type:"section",htmlClass:"cn-batch-wrapper",items:s?[i,s,n]:[i,n],condition:this.processCondition(i.condition)},delete i.condition,i.key&&(this.fieldRegister[i.key]||(this.fieldRegister[i.key]={}),this.fieldRegister[i.key].field=i,this.fieldRegister[i.key].dirtyCheck=s)}i||e.splice(t,1),--t}}function g(e){return e&&e.replace(/\b(model)\.(\S*)\b/g,'($1.$2 === undefined ? $1.__ogValues["$2"] : $1.$2)')}function y(e){if(e.key){if(!e.batchConfig)return!1;e._key=e.key,e._placeholder=e.placeholder,e.schema=e.schema||t.getSchema(e.key,this.schema.schema.properties),e.type=e.type||e.schema.type,delete e.required,e.resolve&&delete e.resolve.required,e.conditionals&&delete e.conditionals.required;var n=i.getFieldType(e),s=o[n];if(s){if(_.isString(s)&&(s=this[s]),_.isObject(e.batchConfig)||(e.batchConfig={}),e.batchConfig.ogValues=this.getModelValues(e),_.allEqual(e.batchConfig.ogValues)){var r='__ogValues["'+e.key+'"]',a=_.first(e.batchConfig.ogValues);t.parseExpression(r,this.model).set(a)}return s.bind(this)(e)}return!1}if(e.items){if(e.batchConfig&&e.items.forEach(function(t){t.batchConfig=_.clone(e.batchConfig)}),this.processItems(e.items),!e.items.length)return!1;e.batchConfig&&(_.isObject(e.batchConfig)||(e.batchConfig={}),e.batchConfig.key="component_"+_.uniqueId(),e.batchConfig.watch=[],e.items.forEach(function(t,i){var n=t.items[0];i||(e.batchConfig.editModes=n.batchConfig.editModes,e.batchConfig.default=n.batchConfig.default),e.batchConfig.watch.push({resolution:'model.__batchConfig["'+n.key+'"] = model.__batchConfig["'+e.batchConfig.key+'"]'}),t.items[2].htmlClass="hide"}))}return e}function b(e){var t=this;return e=e||["replace"],e.map(function(e){return t.editModes[e]=!0,{name:_.capitalize(e),value:e}})}function v(e){return e||"replace"}function k(e){var t=e.batchConfig,i='__batchConfig["'+(e.key||t.key)+'"]',n={key:i,type:"radiobuttons",titleMap:this.getTitleMap(t.editModes),htmlClass:"cn-batch-options",btnClass:"btn-sm cn-no-dirty-check",watch:t.watch||[]};return 1===n.titleMap.length&&(n.htmlClass="hide"),this.addToSchema(i,{type:"string",title:"Edit Mode",default:this.getSchemaDefault(t.default)}),t.onSelect&&n.watch.push({resolution:function(e,i){e&&t.onSelect[e](i)}}),n}function C(e,i){var n=this,s=t.getKey(e.key);e.schema&&"array"===e.schema.type&&(_.isUndefined(e.schema._minItems)&&(e.schema._minItems=e.schema.minItems),e.schema.minItems=i?e.schema._minItems:0),(s?this.getFormFromRegister(s):[]).forEach(function(e){e.scope&&(e.scope.options=e.scope.options||{},e.scope.options.tv4Validation=i,Object.keys(e.ngModel.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(t){e.ngModel.$setValidity(t,!0)}))}),e.items&&e.items.forEach(function(e){return n.setValidation(e,i)})}function x(e){if(e.includes("[]")){var t=new RegExp(e.replace("[]","\\[\\d*\\]"));return _.filter(this.fieldRegister,function(e,i){return t.test(i)})}return this.fieldRegister[e]?[this.fieldRegister[e]]:[]}function E(e){var i=this,n='__dirtyCheck["'+(e.key||e.batchConfig.key)+'"]',s="";!e.notitle&&e.schema.title||(s+=" notitle");var o={key:n,htmlClass:s,type:"cn-dirty-check",watch:[{resolution:function(t){i.setValidation(e,t),r.$broadcast("schemaFormValidate")}}]};return this.addToSchema(n,{type:"boolean",notitle:!0}),o.fieldWatch={resolution:function(s){var r=i.fieldRegister[e._key];r?_.get(r,"ngModel.$dirty")&&t.parseExpression(n,i.model).set(!0):console.debug("no register:",e,i.fieldRegister)}},this.registerFieldWatch(e,o.fieldWatch),o}function M(e,t){e.watch?_.isArray(e.watch)||(e.watch=[e.watch]):e.watch=[],e.watch.push(t)}function S(e,t){var i=this.fieldRegister[t];if(!i)return console.debug("no register:",t,this.fieldRegister);i.dirtyCheck&&this.registerFieldWatch(i.field,i.dirtyCheck.fieldWatch)}function w(e,i){var n=this;return function(s){e.forEach(function(e){if(!i){var r=n.fieldRegister[e];if(!_.get(r,"ngModel.$dirty"))return}t.parseExpression('__dirtyCheck["'+e+'"]',n.model).set(s)})}}function R(e,t){var i=this;e.forEach(function(e){e.forEach(function(n){var s=i.fieldRegister[n];if(!s)return void console.debug("no register:",n);var r=s.field,o=s.dirtyCheck,a=i.handleLinks(_.without(e,n),t);r.watch=r.watch||[],o.watch=o.watch||[],r.watch.push({resolution:function(){a(!0)}}),o.watch.push({resolution:a})})})}function F(){this.schema.batchConfig&&(this.schema.batchConfig.links&&this.processLinkList(this.schema.batchConfig.links),this.schema.batchConfig.hardLinks&&this.processLinkList(this.schema.batchConfig.hardLinks,!0))}function $(e,t){var i=s.parse(e),n=this.schema.schema;i.forEach(function(e,s){s===i.length-1?(n.properties||(n.properties={}),n.properties[e]=t):""===e?(n.items||(n.items={type:"object"}),n=n.items):(n.properties||(n.properties={}),n.properties[e]||(n.properties[e]={type:"object"}),n=n.properties[e])})}function V(e){return this.models.map(function(i){return t.parseExpression(e.key,i).get()})}function D(){var e=this,i=[];return _.each(this.fieldRegister,function(n,r){if(t.parseExpression('__dirtyCheck["'+r+'"]',e.model).get()){var o=t.parseExpression('__batchConfig["'+r+'"]',e.model).get();e.models.forEach(function(n,a){i[a]=i[a]||{};var c=s.parse(r);c.length>1&&!i[a][c[0]]&&(i[a][c[0]]=e.models[a][c[0]]);var l=t.parseExpression(r,e.models[a]).getAssignable();if(l.fullPath!==r){var d=t.parseExpression(l.fullPath,e.model).get();t.parseExpression(l.fullPath,e.models[a]).set(d)}else{var h=t.parseExpression(r,e.model).get(),f=t.parseExpression(r,i[a]),u=t.parseExpression(r,e.models[a]);e.setValue(h,f,u,o)}})}}),i}function j(e,i,n,s){if("replace"===s)i.set(e);else if("append"===s){var r=n.get();if(_.isArray(r)){var o=_([]).concat(r,e).uniq(function(e){return e.key||angular.toJson(e)}).value();i.set(o)}else _.isString(r)?i.set(r+" "+e.trim()):i.set(e)}else if("prepend"===s){var a=n.get();_.isArray(a)?i.set(e.concat(a)):_.isString(a)?i.set(e.trim()+" "+a):i.set(e)}else if("increase"===s)i.set(_.add(n.get()||0,e));else if("decrease"===s)i.set(_.subtract(n.get()||0,e));else if("stringReplace"===s&&n.get()){var c=n.path().key,l=t.parseExpression("_replace_"+c,this.model),d=t.parseExpression("_with_"+c,this.model),h=new RegExp(_.escapeRegExp(l.get()),"gi");i.set(n.get().replace(h,d.get()))}}function P(e,t){e.noBatchPlaceholder||(e.placeholder=t)}function I(e){var i=this,n=e.batchConfig;if(n.editModes=n.editModes||["replace","prepend","append","stringReplace"],n.default=n.default||"append",n.editModes.includes(n.default)||(n.default=n.editModes[0]),n.onSelect={replace:function(){_.allEqual(n.ogValues)?t.parseExpression(e.key,i.model).set(_.first(n.ogValues),{silent:!0}):P(e,"—")},append:function(){P(e,"")},prepend:function(){P(e,"")},stringReplace:function(){}},n.editModes.includes(n.default)&&n.onSelect[n.default](),n.editModes.includes("stringReplace")){var s=this.createDirtyCheck(e),r='__batchConfig["'+(e.key||e.batchConfig.key)+'"]',o="_replace_"+(e.key||e.batchConfig.key),a="_with_"+(e.key||e.batchConfig.key),c={type:"component",items:[{key:o,title:"Replace",watch:{resolution:"model."+s.key+" = true"}},{key:a,title:"With",watch:{resolution:"model."+s.key+" = true"}}],condition:"model."+r+" === 'stringReplace'"};return n.key=e.key,this.addToSchema(o,{type:"string"}),this.addToSchema(a,{type:"string"}),{type:"section",condition:e.condition,batchConfig:n,schema:e.schema,items:[_.extend(e,{condition:"model."+r+" !== 'stringReplace'"}),c,s]}}return e}function q(e){var i=e.batchConfig;return i.editModes=i.editModes||["replace","decrease","increase"],_.allEqual(i.ogValues)?t.parseExpression(e.key,this.model).set(_.first(i.ogValues),{silent:!0}):e.placeholder="—",e}function L(e){e.items||P(e,"—")}function T(e){var i=this,n=e.schema.type,s=e.batchConfig;if("array"===n)s.editModes=s.editModes||["replace","append"],s.default=s.default||"replace",_.allEqual(s.ogValues)?a(function(){return t.parseExpression(e.key,i.model).set(_.first(angular.copy(s.ogValues)),{silent:!0})}):L(e),s.onSelect={replace:function(n){n&&"append"!==n&&t.parseExpression(e.key,i.model).set([])},append:function(n){"replace"!==n&&t.parseExpression(e.key,i.model).set([])},remove:function(){var n=_.chain(e.batchConfig.ogValues).flatten().uniq().value();t.parseExpression(e.key,i.model).set(n,{silent:!0})}};else{var r=_.first(s.ogValues);r&&_.allEqual(s.ogValues)&&t.parseExpression(e.key,this.model).set(r,{silent:!0}),e.placeholder||P(e,"—")}return e}function A(e){var i=e.batchConfig;return _.allEqual(i.ogValues)?t.parseExpression(e.key,this.model).set(_.first(i.ogValues,{silent:!0})):P(e,"—"),e}function O(e){var i=e.batchConfig;return _.allEqual(i.ogValues)&&t.parseExpression(e.key,this.model).set(_.first(i.ogValues,{silent:!0})),e}function B(){var e=this;this.schema.schema.required=void 0,_.each(this.schema.schema.properties,function(t,i){return n(e,t,i)}),this.schema.schema.properties.__batchConfig={type:"object",properties:{}},this.schema.schema.properties.__dirtyCheck={type:"object",properties:{}},r.$on("schemaFormBeforeAppendToArray",function(t,i){return e.restoreDefaults(i)}),r.$on("schemaFormAfterAppendToArray",function(t,i){return e.resetDefaults(i)})}function W(e){var i=this;e.items&&(e.items.forEach(function(e){if(e.key&&e.schema){var n=t.getKey(e.key).replace(/\[\d+]/g,"[]");e.schema.default=i.defaults[n]}i.restoreDefaults(e)}),N(e.items))}function N(e){_.each(e,function(e){e.placeholder=e._placeholder,e.noBatchPlaceholder=!0,e.items&&N(e.items)})}function K(e){var t=this;e.items&&e.items.forEach(function(e){e.schema&&(e.schema.default=void 0),t.resetDefaults(e)})}function U(e,t){var i=this;this.results=e,this.resultsConfig=t,this.modal&&this.modal.close(),this.modal=c.open({controller:"BatchResults",controllerAs:"vm",templateUrl:"cn-batch-forms/batch-results.html",resolve:{parent:function(){return i}}})}function J(){this.modal.close(),this.results=[],this.resultsConfig=null}function z(){this.schema.meta='\n        <div class="well">\n          <h5>Edit Modes</h5>\n          <p>Some types of fields allow you to apply batch changes in\n          different ways:</p>\n          <dl>\n            <dt>Replace:</dt>\n            <dd>Replace all the original values\n            with the new value. <em>(If you don\'t see an <b>Edit Mode</b> option\n            for a field, this will be the default)</em></dd>\n          </dl>\n          '+this.getEditModeLegends()+"\n        </div>"}function G(){var e="";return this.editModes.prepend&&(e+="\n          <dl>\n            <dt>Prepend:</dt>\n            <dd>Add the new value to the start of the original\n            values for each item.</dd>\n          </dl>"),this.editModes.append&&(e+="\n          <dl>\n            <dt>Append:</dt>\n            <dd>Affix the new value at the end of the original\n            values for each item.</dd>\n          </dl>"),this.editModes.decrease&&(e+="\n          <dl>\n            <dt>Decrease:</dt>\n            <dd>Subtract the given value from the original\n            values for each item.</dd>\n          </dl>"),this.editModes.increase&&(e+="\n          <dl>\n            <dt>Increase:</dt>\n            <dd>Add the given value to the original\n            values for each item.</dd>\n          </dl>"),e}var H=0;return{augmentSchema:l}}r.$inject=["cnFlexFormConfig","cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","$timeout","cnModal"],Object.defineProperty(t,"__esModule",{value:!0}),t.clearSchemaDefault=n,t.default=s;var o={string:"processDefault",number:"processNumber",url:"processDefault",array:"processSelect","cn-autocomplete":"processSelect","cn-currency":"processNumber","cn-datetimepicker":"processDate","cn-toggle":"processToggle"}},function(e,t,i){"use strict";function n(e){"ngInject";e.put("cn-batch-forms/batch-results.html",'\n    <div class="cn-modal">\n      <div class="modal-header clearfix">\n        <cn-flex-form-header\n          ff-header-config="vm.headerConfig"\n          ff-submit="vm.submit(handler)">\n        </cn-flex-form-header>\n      </div>\n      <div class="modal-body cn-list card-flex"\n           cn-responsive-height="80"\n           cn-responsive-break="sm"\n           cn-set-max-height>\n\n        <div class="padding-20"\n             ng-if="vm.text">\n          <p class="no-margin text-mute"\n             ng-bind-html="vm.text">\n          </p>\n        </div>\n\n        <table class="table gutterless">\n          <tbody>\n          <tr ng-repeat="result in vm.results">\n            <td class="col-sm-10">\n              <h6 ng-show="result.status == 200">\n                {{result.body[vm.displayName]}}\n                <span class="text-mute">({{result.body.id}})</span>\n              </h6>\n              <h6 ng-show="result.status != 200">\n                {{vm.originals[$index][vm.displayName]}}\n                <span class="text-mute">({{vm.originals[$index].id}})</span>\n              </h6>\n              <p ng-class="{\n                   \'text-danger\': result.status != 200,\n                   \'text-primary\': result.status == 200\n                 }">\n                <i class="fa fa-{{result.status == 200 ? \'check\' : \'times\'}}"></i>\n                {{result.status == 200 ? \'updated successfully\' : result.body.message}}\n              </p>\n            </td>\n            <td class="col-sm-2 text-center">\n              <a class="btn btn-sm btn-transparent"\n                 ng-show="vm.showEdit(result)"\n                 ui-sref="{{ result.editSref }}">\n                <i class="icn-edit"></i>\n              </a>\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n    ')}n.$inject=["$templateCache"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}]);