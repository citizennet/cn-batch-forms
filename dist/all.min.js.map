{"version":3,"sources":["all.min.js","_.cn-batch-forms.module.js","batch-results.js","cn-batch-forms.routes.js","cn-batch-forms.service.js","templates.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","angular","module","BatchResults","$state","parent","$timeout","activate","console","log","vm","results","cancel","headerConfig","title","main","actionConfig","actions","text","noData","go","this","originals","models","config","resultsConfig","displayName","done","controller","$inject","cnBatchFormsConfig","cnFlexFormServiceProvider","cnFlexFormModalLoaderServiceProvider","registerField","condition","field","type","TYPE","handler","templateUrl","TEMPLATE_URL","addMapping","controllerAs","addTemplates","$templateCache","put","run","cnBatchForms","cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","cnFlexFormModalLoaderService","augmentSchema","schema","model","length","service","BatchForms","create","constructor","addMeta","addToSchema","clearDefaults","clearSchemaDefault","closeModal","createDirtyCheck","createBatchField","getChangedModels","getEditModeLegends","getModelValues","getSchemaDefault","getTitleMap","onFieldScope","processCondition","processForm","processField","processItems","processDate","processDefault","processNumber","processSelect","processToggle","setValue","showResults","instance","instances","resolveMapping","editModes","fieldRegister","forms","i","form","splice","$on","bind","event","scope","_key","ngModel","$pristine","children","arguments","undefined","child","show","batchConfig","htmlClass","batchField","dirtyCheck","items","replace","getSchema","properties","fieldType","getFieldType","fieldTypeHandlers","_","isObject","ogValues","allEqual","first","parseExpression","set","_this","map","name","capitalize","def","titleMap","btnClass","default","onSelect","watch","resolution","val","prev","_this2","path","parse","notitle","readonly","isArray","push","equals","register","$dirty","initiated","depth","forEach","k","get","_this3","each","dirty","mode","update","original","originalVal","concat","isString","trim","placeholder","append","prepend","_this4","remove","chain","flatten","uniq","titleMapResolve","data","find","valueProperty","displayProperty","moment","format","onValue","undefinedClass","required","__batchConfig","__dirtyCheck","modal","modalId","onCloseModal","e","toState","toParams","returnState","params","meta","legends","decrease","increase","string","number","cn-autocomplete","cn-currency","cn-datetimepicker","cn-toggle","factory"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\n(function () {\n  angular.module('cn.batch-forms', ['schemaForm', 'cn.flex-form', 'cn.util', 'ui.router']);\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$timeout'];\n\n  function BatchResults($state, parent, $timeout) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n\n    vm.activate = activate;\n    vm.cancel = cancel;\n    vm.done = cancel;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n\n      if (!vm.results) {\n        // the modal doesn't go away without the timeout\n        $timeout(vm.cancel);\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Cool'\n          }]\n        },\n        noData: true\n      };\n    }\n\n    function cancel() {\n      $state.go('^');\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').config(cnBatchFormsConfig).run(addTemplates);\n\n  var TYPE = 'cn-dirty-check';\n  var TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = ['cnFlexFormServiceProvider', 'cnFlexFormModalLoaderServiceProvider'];\n\n  function cnBatchFormsConfig(cnFlexFormServiceProvider, cnFlexFormModalLoaderServiceProvider) {\n\n    cnFlexFormServiceProvider.registerField({\n      condition: function condition(field) {\n        return field.type === TYPE;\n      },\n      handler: function handler(field) {/*console.log('field.readonly:', field.key, field.readonly)*/},\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n\n    cnFlexFormModalLoaderServiceProvider.addMapping('results', {\n      controller: 'BatchResults',\n      controllerAs: 'vm',\n      templateUrl: 'cn-batch-forms/batch-results.html'\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(TEMPLATE_URL, '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 ng-disabled=\"form.readonly\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>');\n  }\n})();\n'use strict';\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n(function () {\n  angular.module('cn.batch-forms').factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = ['cnFlexFormService', 'cnFlexFormTypes', 'sfPath', '$rootScope', '$state', '$timeout', 'cnFlexFormModalLoaderService'];\n  function cnBatchForms(cnFlexFormService, cnFlexFormTypes, sfPath, $rootScope, $state, $timeout, cnFlexFormModalLoaderService) {\n\n    var instances = 0;\n\n    var fieldTypeHandlers = {\n      'string': processDefault,\n      'number': processNumber,\n      'cn-autocomplete': processSelect,\n      'cn-currency': processNumber,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema: augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if (!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor: constructor,\n        addMeta: addMeta,\n        addToSchema: addToSchema,\n        clearDefaults: clearDefaults,\n        clearSchemaDefault: clearSchemaDefault,\n        closeModal: closeModal,\n        createDirtyCheck: createDirtyCheck,\n        createBatchField: createBatchField,\n        getChangedModels: getChangedModels,\n        getEditModeLegends: getEditModeLegends,\n        getModelValues: getModelValues,\n        getSchemaDefault: getSchemaDefault,\n        getTitleMap: getTitleMap,\n        onFieldScope: onFieldScope,\n        processCondition: processCondition,\n        processForm: processForm,\n        processField: processField,\n        processItems: processItems,\n        processDate: processDate,\n        processDefault: processDefault,\n        processNumber: processNumber,\n        processSelect: processSelect,\n        processToggle: processToggle,\n        setValue: setValue,\n        showResults: showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.editModes = {};\n      this.fieldRegister = {};\n\n      this.clearDefaults();\n\n      if (schema.forms) {\n        var i = schema.forms.length - 1;\n        while (i > -1) {\n          this.processForm(schema.forms[i]);\n          if (!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      } else {\n          this.processForm(schema.form);\n        }\n\n      this.addMeta();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      var key = scope.form._key;\n      //console.log('onFieldScope:', key, scope.form.key, scope);\n      if (key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n      // prevent edit mode radiobuttons from setting form to dirty\n      else if (scope.form.key[0] === '__batchConfig') {\n          scope.ngModel.$pristine = false;\n        }\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field) {\n      var children = arguments.length <= 1 || arguments[1] === undefined ? 'items' : arguments[1];\n\n      //console.log('processItems:', field, children);\n      var i = field[children].length - 1;\n      while (i > -1) {\n        var child = field[children][i];\n        var show = this.processField(child);\n        if (child.batchConfig && show) {\n          //console.log('child:', child);\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field';\n          var batchField = this.createBatchField(child);\n          var dirtyCheck = this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: [child, dirtyCheck, batchField],\n            condition: this.processCondition(child.condition)\n          };\n          delete child.condition;\n          this.fieldRegister[child.key] = {\n            field: child\n          };\n        }\n        if (!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processCondition(condition) {\n      return condition && condition.replace(/\\b(model)\\.(\\S*)\\b/g, '($1.$2 === undefined ? $1.__ogValues[\"$2\"] : $1.$2)');\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if (field.key) {\n        if (!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        var fieldType = cnFlexFormTypes.getFieldType(field);\n        var handler = fieldTypeHandlers[fieldType];\n\n        if (handler) {\n          if (!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          if (_.allEqual(field.batchConfig.ogValues)) {\n            var key = '__ogValues[\"' + field.key + '\"]';\n            var first = _.first(field.batchConfig.ogValues);\n            cnFlexFormService.parseExpression(key, this.model).set(first);\n          }\n\n          handler.bind(this)(field);\n        } else return false;\n      } else if (field.items) {\n        this.processItems(field);\n        if (!field.items.length) return false;\n      }\n      return true;\n    }\n\n    function getTitleMap(editModes) {\n      var _this = this;\n\n      editModes = editModes || ['replace'];\n\n      return editModes.map(function (value) {\n        _this.editModes[value] = true;\n        return {\n          name: _.capitalize(value),\n          value: value\n        };\n      });\n    }\n\n    function getSchemaDefault(def) {\n      return def || 'replace';\n    }\n\n    function createBatchField(field) {\n      var key = '__batchConfig[\"' + field.key + '\"]';\n\n      var batchField = {\n        key: key,\n        type: 'radiobuttons',\n        titleMap: this.getTitleMap(field.batchConfig.editModes),\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-sm cn-no-dirty-check'\n      };\n\n      if (batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(key, {\n        type: 'string',\n        title: 'Edit Mode',\n        default: this.getSchemaDefault(field.batchConfig.default)\n      });\n\n      if (field.batchConfig.onSelect) {\n        batchField.watch = {\n          resolution: function resolution(val, prev) {\n            console.log('field.batchConfig.onSelect, val, prev:', field.batchConfig.onSelect, val, prev);\n            field.batchConfig.onSelect[val](prev);\n          }\n        };\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      var _this2 = this;\n\n      var path = sfPath.parse(field.key);\n      var key = '__dirtyCheck[\"' + path[0] + '\"]';\n      var child = path.length > 1;\n      var htmlClass = '';\n\n      //if(child) htmlClass += ' semi-transparent';\n      if (field.notitle || !field.schema.title) htmlClass += ' notitle';\n\n      var dirtyCheck = {\n        key: key,\n        htmlClass: htmlClass,\n        type: 'cn-dirty-check'\n      };\n\n      this.addToSchema(key, {\n        type: 'boolean',\n        notitle: true\n      });\n\n      console.log('dirtyCheck:', field.key, dirtyCheck.readonly);\n\n      if (!child) {\n        if (field.watch) {\n          if (!_.isArray(field.watch)) field.watch = [field.watch];\n        } else {\n          field.watch = [];\n        }\n\n        field.watch.push({\n          resolution: function resolution(val, prev) {\n            if (!angular.equals(val, prev)) {\n              var register = _this2.fieldRegister[field.key];\n              if (register) {\n                if (register.ngModel && register.ngModel.$dirty || register.initiated) {\n                  //console.log('dirtyCheck.key:', dirtyCheck.key);\n                  cnFlexFormService.parseExpression(dirtyCheck.key, _this2.model).set(true);\n                } else {\n                  console.log('initiated:', register);\n                  register.initiated = true;\n                }\n              }\n              // debug\n              else {\n                  console.log('noregister:', register);\n                }\n            }\n          }\n        });\n      }\n\n      return dirtyCheck;\n    }\n\n    function addToSchema(key, schema) {\n      var path = sfPath.parse(key);\n      var depth = this.schema.schema;\n\n      path.forEach(function (k, i) {\n        if (i === path.length - 1) {\n          if (!depth.properties) {\n            depth.properties = {};\n          }\n          depth.properties[k] = schema;\n        } else if (k === '') {\n          if (!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        } else {\n          if (!depth.properties) {\n            depth.properties = {};\n          }\n          if (!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(function (model) {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      var _this3 = this;\n\n      var models = [];\n\n      _.each(this.fieldRegister, function (register, key) {\n        var dirty = cnFlexFormService.parseExpression('__dirtyCheck[\"' + key + '\"]', _this3.model).get();\n\n        console.log('key, dirty:', key, dirty, register);\n        if (!dirty) return;\n\n        var mode = cnFlexFormService.parseExpression('__batchConfig[\"' + key + '\"]', _this3.model).get();\n\n        _this3.models.forEach(function (model, i) {\n          if (!models[i]) models[i] = {};\n\n          var val = cnFlexFormService.parseExpression(key, _this3.model).get();\n          var update = cnFlexFormService.parseExpression(key, models[i]);\n          var original = cnFlexFormService.parseExpression(key, _this3.models[i]);\n\n          _this3.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if (mode === 'replace') {\n        update.set(val);\n      } else if (mode === 'append') {\n        var originalVal = original.get();\n        if (_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        } else if (_.isString(originalVal)) {\n          update.set(originalVal + ' ' + val.trim());\n        }\n      } else if (mode === 'prepend') {\n        var originalVal = original.get();\n        if (_.isArray(originalVal)) {\n          update.set(val.concat(originalVal));\n        } else if (_.isString(originalVal)) {\n          update.set(val.trim() + ' ' + originalVal);\n        }\n      } else if (mode === 'increase') {\n        update.set(original.get() + val);\n      } else if (mode === 'decrease') {\n        update.set(original.get() - val);\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processDefault(field) {\n      var config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'prepend', 'append'];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: function replace() {\n          if (_.allEqual(config.ogValues)) {\n            field.placeholder = _.first(config.ogValues);\n          } else {\n            field.placeholder = '—';\n          }\n        },\n        append: function append() {\n          field.placeholder = '';\n        },\n        prepend: function prepend() {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processNumber(field) {\n      var config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'decrease', 'increase'];\n\n      if (_.allEqual(config.ogValues)) {\n        field.placeholder = _.first(config.ogValues);\n      } else {\n        field.placeholder = '—';\n      }\n\n      console.log('number placeholder:', field.placeholder);\n    }\n\n    function processSelect(field) {\n      var _this4 = this;\n\n      var type = field.schema.type;\n      var config = field.batchConfig;\n\n      if (type === 'array') {\n        config.editModes = config.editModes || ['replace', 'append'];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: function replace(prev) {\n            if (prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, _this4.model).set([]);\n            }\n          },\n          append: function append(prev) {\n            if (prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, _this4.model).set([]);\n            }\n          },\n          remove: function remove() {\n            var val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, _this4.model).set(val);\n          }\n        };\n      } else {\n\n        var first = _.first(config.ogValues);\n        //TODO: dynamically send back data\n        if (first && _.allEqual(config.ogValues)) {\n          var titleMap = field.titleMap || field.titleMapResolve && this.schema.data[field.titleMapResolve];\n          console.log('titleMap, first:', titleMap, first);\n          if (titleMap /* && !_.isObject(first)*/) {\n              first = _.find(titleMap, _defineProperty({}, field.valueProperty || 'value', first));\n            }\n          field.placeholder = first[field.displayProperty || 'name'];\n        }\n\n        if (!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      var config = field.batchConfig;\n\n      if (_.allEqual(config.ogValues)) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      } else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      var config = field.batchConfig;\n\n      if (_.allEqual(config.ogValues)) {\n        if (_.first(config.ogValues) == field.onValue) {\n          field.undefinedClass = 'semi-transparent';\n        } else {\n          field.undefinedClass = 'disabled semi-transparent';\n        }\n      }\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = [];\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if (schema.type === 'object' && schema.properties) {\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      } else if (schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      console.log('showResults:', results, this);\n      this.results = results;\n      this.resultsConfig = config;\n\n      $state.go('.modal', {\n        modal: 'results',\n        modalId: this.instance\n      });\n\n      this.onCloseModal = $rootScope.$on('$stateChangeStart', this.closeModal.bind(this));\n    }\n\n    function closeModal(e, toState, toParams) {\n      console.log('closeModal:', e, toState, toParams);\n      console.log('this.resultsConfig:', this.resultsConfig);\n      this.onCloseModal();\n\n      var config = this.resultsConfig;\n      if (config && config.returnState) {\n        //timeout needed so current state\n        $timeout(function () {\n          return $state.go(config.returnState.name, config.returnState.params);\n        });\n      }\n\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = '\\n          <div class=\"well\">\\n            <h5>Edit Modes</h5>\\n            <p>Some types of fields allow you to apply batch changes in\\n            different ways:</p>\\n            <dl>\\n              <dt>Replace:</dt>\\n              <dd>Replace all the original values\\n              with the new value. <em>(If you don\\'t see an <b>Edit Mode</b> option\\n              for a field, this will be the default)</em></dd>\\n            </dl>\\n            ' + this.getEditModeLegends() + '\\n          </div>';\n    }\n\n    function getEditModeLegends() {\n      var legends = '';\n\n      if (this.editModes.prepend) {\n        legends += '\\n            <dl>\\n              <dt>Prepend:</dt>\\n              <dd>Add the new value to the start of the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.append) {\n        legends += '\\n            <dl>\\n              <dt>Append:</dt>\\n              <dd>Affix the new value at the end of the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.decrease) {\n        legends += '\\n            <dl>\\n              <dt>Decrease:</dt>\\n              <dd>Subtract the given value from the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.increase) {\n        legends += '\\n            <dl>\\n              <dt>Increase:</dt>\\n              <dd>Add the given value to the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      return legends;\n    }\n  }\n})();\n\"use strict\";\n\nangular.module(\"cn.batch-forms\").run([\"$templateCache\", function ($templateCache) {\n  $templateCache.put(\"cn-batch-forms/batch-results.html\", \"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header clearfix\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.done()\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <ul class=\\\"list-group gutterless\\\">\\n      <li ng-repeat=\\\"result in vm.results\\\"\\n          class=\\\"list-group-item\\\"\\n          ng-class=\\\"{\\n            \\'text-danger\\': result.status != 200,\\n            \\'text-primary\\': result.status == 200\\n          }\\\">\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-sm-1 text-center\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}} ({{result.body.id}}):\\n            updated successfully\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}} ({{vm.originals[$index].id}}):\\n            {{result.body.message}}\\n          </div>\\n        </div>\\n      </li>\\n    </ul>\\n  </div>\\n</div>\\n\");\n}]);","(function() {\n  angular.module('cn.batch-forms', [\n    'schemaForm',\n    'cn.flex-form',\n    'cn.util',\n    'ui.router'\n  ]);\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$timeout'];\n\n  function BatchResults($state, parent, $timeout) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n\n    vm.activate = activate;\n    vm.cancel = cancel;\n    vm.done = cancel;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n\n      if(!vm.results) {\n        // the modal doesn't go away without the timeout\n        $timeout(vm.cancel);\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Cool'\n          }]\n        },\n        noData: true\n      };\n    }\n\n    function cancel() {\n      $state.go('^');\n    }\n\n  }\n\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .config(cnBatchFormsConfig)\n      .run(addTemplates);\n\n  const TYPE = 'cn-dirty-check';\n  const TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = [\n    'cnFlexFormServiceProvider',\n    'cnFlexFormModalLoaderServiceProvider'\n  ];\n\n  function cnBatchFormsConfig(\n      cnFlexFormServiceProvider,\n      cnFlexFormModalLoaderServiceProvider) {\n\n    cnFlexFormServiceProvider.registerField({\n      condition: (field) => field.type === TYPE,\n      handler: (field) => {/*console.log('field.readonly:', field.key, field.readonly)*/},\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n\n    cnFlexFormModalLoaderServiceProvider.addMapping('results', {\n      controller: 'BatchResults',\n      controllerAs: 'vm',\n      templateUrl: 'cn-batch-forms/batch-results.html'\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(\n        TEMPLATE_URL,\n        '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 ng-disabled=\"form.readonly\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>'\n    );\n  }\n\n})();","(function() {\n  angular\n      .module('cn.batch-forms')\n      .factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = [\n    'cnFlexFormService',\n    'cnFlexFormTypes',\n    'sfPath',\n    '$rootScope',\n    '$state',\n    '$timeout',\n    'cnFlexFormModalLoaderService'\n  ];\n  function cnBatchForms(\n      cnFlexFormService,\n      cnFlexFormTypes,\n      sfPath,\n      $rootScope,\n      $state,\n      $timeout,\n      cnFlexFormModalLoaderService) {\n\n    let instances = 0;\n\n    let fieldTypeHandlers = {\n      'string': processDefault,\n      'number': processNumber,\n      'cn-autocomplete': processSelect,\n      'cn-currency': processNumber,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if(!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor,\n        addMeta,\n        addToSchema,\n        clearDefaults,\n        clearSchemaDefault,\n        closeModal,\n        createDirtyCheck,\n        createBatchField,\n        getChangedModels,\n        getEditModeLegends,\n        getModelValues,\n        getSchemaDefault,\n        getTitleMap,\n        onFieldScope,\n        processCondition,\n        processForm,\n        processField,\n        processItems,\n        processDate,\n        processDefault,\n        processNumber,\n        processSelect,\n        processToggle,\n        setValue,\n        showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.editModes = {};\n      this.fieldRegister = {};\n\n      this.clearDefaults();\n\n      if(schema.forms) {\n        let i = schema.forms.length - 1;\n        while(i > -1) {\n          this.processForm(schema.forms[i]);\n          if(!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      }\n      else {\n        this.processForm(schema.form);\n      }\n\n      this.addMeta();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      let key = scope.form._key;\n      //console.log('onFieldScope:', key, scope.form.key, scope);\n      if(key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n      // prevent edit mode radiobuttons from setting form to dirty\n      else if(scope.form.key[0] === '__batchConfig') {\n        scope.ngModel.$pristine = false;\n      }\n\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field, children = 'items') {\n      //console.log('processItems:', field, children);\n      let i = field[children].length - 1;\n      while(i > -1) {\n        let child = field[children][i];\n        let show = this.processField(child);\n        if(child.batchConfig && show) {\n          //console.log('child:', child);\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field';\n          let batchField = this.createBatchField(child);\n          let dirtyCheck = this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: [child, dirtyCheck, batchField],\n            condition: this.processCondition(child.condition)\n          };\n          delete child.condition;\n          this.fieldRegister[child.key] = {\n            field: child\n          };\n        }\n        if(!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processCondition(condition) {\n      return condition && condition.replace(/\\b(model)\\.(\\S*)\\b/g, '($1.$2 === undefined ? $1.__ogValues[\"$2\"] : $1.$2)');\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if(field.key) {\n        if(!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        let fieldType = cnFlexFormTypes.getFieldType(field);\n        let handler = fieldTypeHandlers[fieldType];\n\n        if(handler) {\n          if(!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          if(_.allEqual(field.batchConfig.ogValues)) {\n            let key = `__ogValues[\"${field.key}\"]`;\n            let first = _.first(field.batchConfig.ogValues);\n            cnFlexFormService.parseExpression(key, this.model).set(first);\n          }\n\n          handler.bind(this)(field);\n        }\n        else return false;\n      }\n      else if(field.items) {\n        this.processItems(field);\n        if(!field.items.length) return false;\n      }\n      return true;\n    }\n\n    function getTitleMap(editModes) {\n      editModes = editModes || ['replace'];\n\n      return editModes.map(value => {\n        this.editModes[value] = true;\n        return {\n          name: _.capitalize(value),\n          value\n        };\n      });\n    }\n\n    function getSchemaDefault(def) {\n      return def || 'replace';\n    }\n\n    function createBatchField(field) {\n      let key = `__batchConfig[\"${field.key}\"]`;\n\n      let batchField = {\n        key,\n        type: 'radiobuttons',\n        titleMap: this.getTitleMap(field.batchConfig.editModes),\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-sm cn-no-dirty-check'\n      };\n\n      if(batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(key, {\n        type: 'string',\n        title: 'Edit Mode',\n        default: this.getSchemaDefault(field.batchConfig.default)\n      });\n\n      if(field.batchConfig.onSelect) {\n        batchField.watch = {\n          resolution: (val, prev) => {\n            console.log('field.batchConfig.onSelect, val, prev:', field.batchConfig.onSelect, val, prev);\n            field.batchConfig.onSelect[val](prev);\n          }\n        };\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      let path = sfPath.parse(field.key);\n      let key = `__dirtyCheck[\"${path[0]}\"]`;\n      let child = path.length > 1;\n      let htmlClass = '';\n\n      //if(child) htmlClass += ' semi-transparent';\n      if(field.notitle || !field.schema.title) htmlClass += ' notitle';\n\n      let dirtyCheck = {\n        key,\n        htmlClass,\n        type: 'cn-dirty-check'\n      };\n\n      this.addToSchema(key, {\n        type: 'boolean',\n        notitle: true\n      });\n\n      console.log('dirtyCheck:', field.key, dirtyCheck.readonly);\n\n      if(!child) {\n        if(field.watch) {\n          if(!_.isArray(field.watch)) field.watch = [field.watch];\n        }\n        else {\n          field.watch = [];\n        }\n\n        field.watch.push({\n          resolution: (val, prev) => {\n            if(!angular.equals(val, prev)) {\n              let register = this.fieldRegister[field.key];\n              if(register) {\n                if((register.ngModel && register.ngModel.$dirty) || register.initiated) {\n                  //console.log('dirtyCheck.key:', dirtyCheck.key);\n                  cnFlexFormService.parseExpression(dirtyCheck.key, this.model).set(true);\n                }\n                else {\n                  console.log('initiated:', register);\n                  register.initiated = true;\n                }\n              }\n              // debug\n              else {\n                console.log('noregister:', register);\n              }\n            }\n          }\n        });\n      }\n\n      return dirtyCheck;\n    }\n\n    function addToSchema(key, schema) {\n      let path = sfPath.parse(key);\n      let depth = this.schema.schema;\n\n      path.forEach((k, i) => {\n        if(i === path.length - 1) {\n          if(!depth.properties) {\n            depth.properties = {};\n          }\n          depth.properties[k] = schema;\n        }\n        else if(k === '') {\n          if(!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        }\n        else {\n          if(!depth.properties) {\n            depth.properties = {};\n          }\n          if(!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(model => {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      let models = [];\n\n      _.each(this.fieldRegister, (register, key) => {\n        let dirty = cnFlexFormService\n            .parseExpression(`__dirtyCheck[\"${key}\"]`, this.model)\n            .get();\n\n        console.log('key, dirty:', key, dirty, register);\n        if(!dirty) return;\n\n        let mode = cnFlexFormService\n            .parseExpression(`__batchConfig[\"${key}\"]`, this.model)\n            .get();\n\n        this.models.forEach((model, i) => {\n          if(!models[i]) models[i] = {};\n\n          let val = cnFlexFormService\n              .parseExpression(key, this.model)\n              .get();\n          let update = cnFlexFormService\n              .parseExpression(key, models[i]);\n          let original = cnFlexFormService\n              .parseExpression(key, this.models[i]);\n\n          this.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if(mode === 'replace') {\n        update.set(val);\n      }\n      else if(mode === 'append') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${originalVal} ${val.trim()}`);\n        }\n      }\n      else if(mode === 'prepend') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(val.concat(originalVal));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${val.trim()} ${originalVal}`);\n        }\n      }\n      else if(mode === 'increase') {\n        update.set(original.get() + val);\n      }\n      else if(mode === 'decrease') {\n        update.set(original.get() - val);\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processDefault(field) {\n      let config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'prepend', 'append'];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: () => {\n          if(_.allEqual(config.ogValues)) {\n            field.placeholder = _.first(config.ogValues);\n          }\n          else {\n            field.placeholder = '—';\n          }\n        },\n        append: () => {\n          field.placeholder = '';\n        },\n        prepend: () => {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processNumber(field) {\n      let config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'decrease', 'increase'];\n\n      if(_.allEqual(config.ogValues)) {\n        field.placeholder = _.first(config.ogValues);\n      }\n      else {\n        field.placeholder = '—';\n      }\n\n      console.log('number placeholder:', field.placeholder);\n    }\n\n    function  processSelect(field) {\n      let type = field.schema.type;\n      let config = field.batchConfig;\n\n      if(type === 'array') {\n        config.editModes = config.editModes || ['replace', 'append'];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: (prev) => {\n            if(prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          append: (prev) => {\n            if(prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          remove: () => {\n            let val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, this.model).set(val);\n          }\n        };\n      }\n      else {\n\n        let first = _.first(config.ogValues);\n        //TODO: dynamically send back data\n        if(first && _.allEqual(config.ogValues)) {\n          let titleMap = field.titleMap || (field.titleMapResolve && this.schema.data[field.titleMapResolve]);\n          console.log('titleMap, first:', titleMap, first);\n          if(titleMap/* && !_.isObject(first)*/) {\n            first = _.find(titleMap, {[field.valueProperty || 'value']: first});\n          }\n          field.placeholder = first[field.displayProperty || 'name'];\n        }\n\n        if(!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      let config = field.batchConfig;\n\n      if(_.allEqual(config.ogValues)) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      }\n      else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      let config = field.batchConfig;\n\n      if(_.allEqual(config.ogValues)) {\n        if(_.first(config.ogValues) == field.onValue) {\n          field.undefinedClass = 'semi-transparent';\n        }\n        else {\n          field.undefinedClass = 'disabled semi-transparent';\n        }\n      }\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = [];\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if(schema.type === 'object' && schema.properties) {\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      }\n      else if(schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      console.log('showResults:', results, this);\n      this.results = results;\n      this.resultsConfig = config;\n\n      $state.go('.modal', {\n        modal: 'results',\n        modalId: this.instance\n      });\n\n      this.onCloseModal = $rootScope.$on('$stateChangeStart', this.closeModal.bind(this));\n    }\n\n    function closeModal(e, toState, toParams) {\n      console.log('closeModal:', e, toState, toParams);\n      console.log('this.resultsConfig:', this.resultsConfig);\n      this.onCloseModal();\n\n      let config = this.resultsConfig;\n      if(config && config.returnState) {\n        //timeout needed so current state\n        $timeout(() => $state.go(config.returnState.name, config.returnState.params));\n      }\n\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = `\n          <div class=\"well\">\n            <h5>Edit Modes</h5>\n            <p>Some types of fields allow you to apply batch changes in\n            different ways:</p>\n            <dl>\n              <dt>Replace:</dt>\n              <dd>Replace all the original values\n              with the new value. <em>(If you don't see an <b>Edit Mode</b> option\n              for a field, this will be the default)</em></dd>\n            </dl>\n            ${this.getEditModeLegends()}\n          </div>`;\n    }\n\n    function getEditModeLegends() {\n      let legends = '';\n\n      if(this.editModes.prepend) {\n        legends += `\n            <dl>\n              <dt>Prepend:</dt>\n              <dd>Add the new value to the start of the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.append) {\n        legends += `\n            <dl>\n              <dt>Append:</dt>\n              <dd>Affix the new value at the end of the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.decrease) {\n        legends += `\n            <dl>\n              <dt>Decrease:</dt>\n              <dd>Subtract the given value from the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.increase) {\n        legends += `\n            <dl>\n              <dt>Increase:</dt>\n              <dd>Add the given value to the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      return legends;\n    }\n  }\n\n})();","angular.module(\"cn.batch-forms\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"cn-batch-forms/batch-results.html\",\"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header clearfix\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.done()\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <ul class=\\\"list-group gutterless\\\">\\n      <li ng-repeat=\\\"result in vm.results\\\"\\n          class=\\\"list-group-item\\\"\\n          ng-class=\\\"{\\n            \\'text-danger\\': result.status != 200,\\n            \\'text-primary\\': result.status == 200\\n          }\\\">\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-sm-1 text-center\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}} ({{result.body.id}}):\\n            updated successfully\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}} ({{vm.originals[$index].id}}):\\n            {{result.body.message}}\\n          </div>\\n        </div>\\n      </li>\\n    </ul>\\n  </div>\\n</div>\\n\");}]);"],"sourceRoot":"/source/"}