{"version":3,"sources":["all.min.js","_.cn-batch-forms.module.js","batch-results.js","cn-batch-forms.routes.js","cn-batch-forms.service.js","templates.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","angular","module","BatchResults","$state","parent","$timeout","activate","console","log","vm","results","cancel","headerConfig","title","main","actionConfig","actions","text","noData","go","this","originals","models","config","resultsConfig","displayName","done","controller","$inject","cnBatchFormsConfig","cnFlexFormServiceProvider","cnFlexFormModalLoaderServiceProvider","registerField","condition","field","type","TYPE","handler","templateUrl","TEMPLATE_URL","addMapping","controllerAs","addTemplates","$templateCache","put","run","cnBatchForms","cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","cnFlexFormModalLoaderService","augmentSchema","schema","model","length","service","BatchForms","create","constructor","addMeta","addToSchema","clearDefaults","clearSchemaDefault","closeModal","createDirtyCheck","createBatchField","onFieldScope","processForm","processField","processItems","processDate","processString","processSelect","processToggle","getModelValues","getChangedModels","setValue","showResults","instance","instances","resolveMapping","fieldRegister","forms","i","form","splice","$on","bind","event","scope","_key","ngModel","children","arguments","undefined","child","show","batchConfig","htmlClass","batchField","dirtyCheck","items","getSchema","properties","fieldType","getFieldType","fieldTypeHandlers","_","isObject","ogValues","titleMap","btnClass","default","onSelect","watch","resolution","val","prev","_this","notitle","isArray","push","equals","register","$dirty","parseExpression","set","start","path","parse","depth","forEach","k","map","get","_this2","each","dirty","mode","update","original","originalVal","concat","isString","trim","name","replace","uniq","placeholder","first","append","prepend","_this3","remove","chain","flatten","every","displayProperty","find","valueProperty","moment","format","required","__batchConfig","__dirtyCheck","modal","modalId","onCloseModal","e","toState","toParams","returnState","params","meta","string","cn-autocomplete","cn-datetimepicker","cn-toggle","factory"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\n(function () {\n  angular.module('cn.batch-forms', ['schemaForm', 'cn.flex-form', 'cn.util', 'ui.router']);\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$timeout'];\n\n  function BatchResults($state, parent, $timeout) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n\n    vm.activate = activate;\n    vm.cancel = cancel;\n    vm.done = cancel;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n\n      if (!vm.results) {\n        // the modal doesn't go away without the timeout\n        $timeout(vm.cancel);\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Cool'\n          }]\n        },\n        noData: true\n      };\n    }\n\n    function cancel() {\n      $state.go('^');\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').config(cnBatchFormsConfig).run(addTemplates);\n\n  var TYPE = 'cn-dirty-check';\n  var TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = ['cnFlexFormServiceProvider', 'cnFlexFormModalLoaderServiceProvider'];\n\n  function cnBatchFormsConfig(cnFlexFormServiceProvider, cnFlexFormModalLoaderServiceProvider) {\n\n    cnFlexFormServiceProvider.registerField({\n      condition: function condition(field) {\n        return field.type === TYPE;\n      },\n      handler: function handler(field) {},\n\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n\n    cnFlexFormModalLoaderServiceProvider.addMapping('results', {\n      controller: 'BatchResults',\n      controllerAs: 'vm',\n      templateUrl: 'cn-batch-forms/batch-results.html'\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(TEMPLATE_URL, '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>');\n  }\n})();\n'use strict';\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n(function () {\n  angular.module('cn.batch-forms').factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = ['cnFlexFormService', 'cnFlexFormTypes', 'sfPath', '$rootScope', '$state', '$timeout', 'cnFlexFormModalLoaderService'];\n  function cnBatchForms(cnFlexFormService, cnFlexFormTypes, sfPath, $rootScope, $state, $timeout, cnFlexFormModalLoaderService) {\n\n    var instances = 0;\n\n    var fieldTypeHandlers = {\n      'string': processString,\n      'cn-autocomplete': processSelect,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema: augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if (!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor: constructor,\n        addMeta: addMeta,\n        addToSchema: addToSchema,\n        clearDefaults: clearDefaults,\n        clearSchemaDefault: clearSchemaDefault,\n        closeModal: closeModal,\n        createDirtyCheck: createDirtyCheck,\n        createBatchField: createBatchField,\n        onFieldScope: onFieldScope,\n        processForm: processForm,\n        processField: processField,\n        processItems: processItems,\n        processDate: processDate,\n        processString: processString,\n        processSelect: processSelect,\n        processToggle: processToggle,\n        getModelValues: getModelValues,\n        getChangedModels: getChangedModels,\n        setValue: setValue,\n        showResults: showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.fieldRegister = {};\n\n      this.clearDefaults();\n\n      if (schema.forms) {\n        var i = schema.forms.length - 1;\n        while (i > -1) {\n          this.processForm(schema.forms[i]);\n          if (!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      } else {\n          this.processForm(schema.form);\n        }\n\n      this.addMeta();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      //console.log('onFieldScope:', scope.form.key, scope);\n      var key = scope.form._key;\n      if (key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field) {\n      var children = arguments.length <= 1 || arguments[1] === undefined ? 'items' : arguments[1];\n\n      //console.log('processItems:', field, children);\n      var i = field[children].length - 1;\n      while (i > -1) {\n        var child = field[children][i];\n        var show = this.processField(child);\n        if (child.batchConfig) {\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field';\n          var batchField = this.createBatchField(child);\n          var dirtyCheck = this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: [child, dirtyCheck, batchField]\n          };\n          this.fieldRegister[child.key] = {\n            field: child\n          };\n        }\n        if (!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if (field.key) {\n        if (!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        var fieldType = cnFlexFormTypes.getFieldType(field);\n        var handler = fieldTypeHandlers[fieldType];\n\n        if (handler) {\n          if (!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          handler.bind(this)(field);\n        } else return false;\n      } else if (field.items) {\n        this.processItems(field);\n        if (!field.items.length) return false;\n      }\n      return true;\n    }\n\n    function createBatchField(field) {\n      var batchField = {\n        type: 'radiobuttons',\n        titleMap: field.batchConfig.titleMap,\n        key: '__batchConfig.' + field.key,\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-small'\n      };\n\n      if (batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(field.key, '__batchConfig', {\n        type: 'string',\n        title: 'Edit Mode',\n        default: field.batchConfig.default\n      });\n\n      if (field.batchConfig.onSelect) {\n        batchField.watch = {\n          resolution: function resolution(val, prev) {\n            field.batchConfig.onSelect[val](prev);\n          }\n        };\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      var _this = this;\n\n      var dirtyCheck = {\n        type: 'cn-dirty-check',\n        htmlClass: field.notitle || !field.schema.title ? 'notitle' : '',\n        key: '__dirtyCheck.' + field.key\n      };\n\n      this.addToSchema(field.key, '__dirtyCheck', {\n        type: 'boolean',\n        notitle: true\n      });\n\n      if (field.watch) {\n        if (!_.isArray(field.watch)) field.watch = [field.watch];\n      } else {\n        field.watch = [];\n      }\n\n      field.watch.push({\n        resolution: function resolution(val, prev) {\n          if (!angular.equals(val, prev)) {\n            var register = _this.fieldRegister[field.key];\n            if (register && register.ngModel.$dirty) {\n              cnFlexFormService.parseExpression(dirtyCheck.key, _this.model).set(true);\n            }\n          }\n        }\n      });\n\n      return dirtyCheck;\n    }\n\n    function addToSchema(key, start, schema) {\n      var path = sfPath.parse(key);\n      var depth = this.schema.schema.properties[start];\n\n      path.forEach(function (k, i) {\n        if (i === path.length - 1) {\n          depth.properties[k] = schema;\n        } else if (k === '') {\n          if (!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        } else {\n          if (!depth.properties) {\n            depth.properties = {};\n          }\n          if (!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(function (model) {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      var _this2 = this;\n\n      var models = [];\n\n      _.each(this.fieldRegister, function (register, key) {\n        var dirty = cnFlexFormService.parseExpression('__dirtyCheck.' + key, _this2.model).get();\n\n        console.log('key, dirty:', key, dirty, register);\n        if (!dirty) return;\n\n        var mode = cnFlexFormService.parseExpression('__batchConfig.' + key, _this2.model).get();\n\n        _this2.models.forEach(function (model, i) {\n          if (!models[i]) models[i] = {};\n\n          var val = cnFlexFormService.parseExpression(key, _this2.model).get();\n          var update = cnFlexFormService.parseExpression(key, models[i]);\n          var original = cnFlexFormService.parseExpression(key, _this2.models[i]);\n\n          _this2.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if (mode === 'replace') {\n        update.set(val);\n      } else if (mode === 'append') {\n        var originalVal = original.get();\n        if (_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        } else if (_.isString(originalVal)) {\n          update.set(originalVal + ' ' + val.trim());\n        }\n      } else if (mode === 'prepend') {\n        var originalVal = original.get();\n        if (_.isArray(originalVal)) {\n          update.set(val.concat(originalVal));\n        } else if (_.isString(originalVal)) {\n          update.set(val.trim() + ' ' + originalVal);\n        }\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processString(field) {\n      var config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n        name: 'Replace',\n        value: 'replace'\n      }, {\n        name: 'Prepend',\n        value: 'prepend'\n      }, {\n        name: 'Append',\n        value: 'append'\n      }];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: function replace() {\n          if (_.uniq(config.ogValues).length === 1) {\n            field.placeholder = _.first(config.ogValues);\n          } else {\n            field.placeholder = '—';\n          }\n        },\n        append: function append() {\n          field.placeholder = '';\n        },\n        prepend: function prepend() {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processSelect(field) {\n      var _this3 = this;\n\n      var type = field.schema.type;\n      var config = field.batchConfig;\n\n      if (type === 'array') {\n        config.titleMap = config.titleMap || [{\n          name: 'Replace',\n          value: 'replace'\n        }, {\n          name: 'Append',\n          value: 'append'\n        } /*, {\n           name: 'Remove',\n           value: 'remove'\n          }*/];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: function replace(prev) {\n            if (prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, _this3.model).set([]);\n            }\n          },\n          append: function append(prev) {\n            if (prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, _this3.model).set([]);\n            }\n          },\n          remove: function remove() {\n            var val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, _this3.model).set(val);\n          }\n        };\n      } else {\n        config.titleMap = config.titleMap || [{\n          name: 'Replace',\n          value: 'replace'\n        }];\n\n        config.default = config.default || 'replace';\n\n        //if(field.titleMap && !_.chain(field.titleMap).first().isObject().value()) {\n        //  field.placeholder = _.first(config.ogValues);\n        //}\n        //if(field.schema.type === 'object') {\n        var first = _.first(config.ogValues);\n        if (_.isObject(first)) {\n          if (_.every(config.ogValues, first)) {\n            field.placeholder = first[field.displayProperty || 'name'];\n          }\n        } else if (_.uniq(config.ogValues).length === 1) {\n          if (field.titleMap) {\n            first = _.find(field.titleMap, _defineProperty({}, field.valueProperty || 'value', first));\n          }\n          field.placeholder = first[field.displayProperty || 'name'];\n        }\n        //}\n        if (!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      var config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n        name: 'Replace',\n        value: 'replace'\n      }];\n\n      config.default = config.default || 'replace';\n\n      if (_.uniq(config.ogValues).length === 1) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      } else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      var config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n        name: 'Replace',\n        value: 'replace'\n      }];\n\n      config.default = config.default || 'replace';\n\n      if (_.uniq(config.ogValues).length === 1) {}\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = [];\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if (schema.type === 'object' && schema.properties) {\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      } else if (schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      console.log('showResults:', results, this);\n      this.results = results;\n      this.resultsConfig = config;\n\n      $state.go('.modal', {\n        modal: 'results',\n        modalId: this.instance\n      });\n\n      this.onCloseModal = $rootScope.$on('$stateChangeStart', this.closeModal.bind(this));\n    }\n\n    function closeModal(e, toState, toParams) {\n      console.log('closeModal:', e, toState, toParams);\n      console.log('this.resultsConfig:', this.resultsConfig);\n      this.onCloseModal();\n\n      var config = this.resultsConfig;\n      if (config && config.returnState) {\n        //timeout needed so current state\n        $timeout(function () {\n          return $state.go(config.returnState.name, config.returnState.params);\n        });\n      }\n\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = '\\n          <div class=\"well\">\\n            <h5>Edit Modes</h5>\\n            <p>Some types of fields allow you to apply batch changes in\\n            different ways:</p>\\n            <dl>\\n              <dt>Replace:</dt>\\n              <dd>Replace all the original values\\n              with the new value. <em>(If you don\\'t see an <b>Edit Mode</b> option\\n              for a field, this will be the default)</em></dd>\\n            </dl>\\n            <dl>\\n              <dt>Prepend:</dt>\\n              <dd>Add the new value to the start of the original\\n              values for each item.</dd>\\n            </dl>\\n            <dl>\\n              <dt>Append:</dt>\\n              <dd>Affix the new value at the end of the original\\n              values for each item.</dd>\\n            </dl>\\n          </div>';\n    }\n  }\n})();\n\"use strict\";\n\nangular.module(\"cn.batch-forms\").run([\"$templateCache\", function ($templateCache) {\n  $templateCache.put(\"cn-batch-forms/batch-results.html\", \"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header cn-heading row vertical-parent\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.done()\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <ul class=\\\"list-group gutterless\\\">\\n      <li ng-repeat=\\\"result in vm.results\\\"\\n          class=\\\"list-group-item\\\"\\n          ng-class=\\\"{\\n            \\'text-danger\\': result.status != 200,\\n            \\'text-primary\\': result.status == 200\\n          }\\\">\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-sm-1 text-center\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}} ({{result.body.id}}):\\n            updated successfully\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}} ({{vm.originals[$index].id}}):\\n            {{result.body.message}}\\n          </div>\\n        </div>\\n      </li>\\n    </ul>\\n  </div>\\n</div>\\n\");\n}]);","(function() {\n  angular.module('cn.batch-forms', [\n    'schemaForm',\n    'cn.flex-form',\n    'cn.util',\n    'ui.router'\n  ]);\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$timeout'];\n\n  function BatchResults($state, parent, $timeout) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n\n    vm.activate = activate;\n    vm.cancel = cancel;\n    vm.done = cancel;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n\n      if(!vm.results) {\n        // the modal doesn't go away without the timeout\n        $timeout(vm.cancel);\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Cool'\n          }]\n        },\n        noData: true\n      };\n    }\n\n    function cancel() {\n      $state.go('^');\n    }\n\n  }\n\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .config(cnBatchFormsConfig)\n      .run(addTemplates);\n\n  const TYPE = 'cn-dirty-check';\n  const TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = [\n    'cnFlexFormServiceProvider',\n    'cnFlexFormModalLoaderServiceProvider'\n  ];\n\n  function cnBatchFormsConfig(\n      cnFlexFormServiceProvider,\n      cnFlexFormModalLoaderServiceProvider) {\n\n    cnFlexFormServiceProvider.registerField({\n      condition(field) {\n        return field.type === TYPE;\n      },\n      handler(field) {\n\n      },\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n\n    cnFlexFormModalLoaderServiceProvider.addMapping('results', {\n      controller: 'BatchResults',\n      controllerAs: 'vm',\n      templateUrl: 'cn-batch-forms/batch-results.html'\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(\n        TEMPLATE_URL,\n        '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>'\n    );\n  }\n\n})();","(function() {\n  angular\n      .module('cn.batch-forms')\n      .factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = [\n    'cnFlexFormService',\n    'cnFlexFormTypes',\n    'sfPath',\n    '$rootScope',\n    '$state',\n    '$timeout',\n    'cnFlexFormModalLoaderService'\n  ];\n  function cnBatchForms(\n      cnFlexFormService,\n      cnFlexFormTypes,\n      sfPath,\n      $rootScope,\n      $state,\n      $timeout,\n      cnFlexFormModalLoaderService) {\n\n    let instances = 0;\n\n    let fieldTypeHandlers = {\n      'string': processString,\n      'cn-autocomplete': processSelect,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if(!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor,\n        addMeta,\n        addToSchema,\n        clearDefaults,\n        clearSchemaDefault,\n        closeModal,\n        createDirtyCheck,\n        createBatchField,\n        onFieldScope,\n        processForm,\n        processField,\n        processItems,\n        processDate,\n        processString,\n        processSelect,\n        processToggle,\n        getModelValues,\n        getChangedModels,\n        setValue,\n        showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.fieldRegister = {};\n\n      this.clearDefaults();\n\n      if(schema.forms) {\n        let i = schema.forms.length - 1;\n        while(i > -1) {\n          this.processForm(schema.forms[i]);\n          if(!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      }\n      else {\n        this.processForm(schema.form);\n      }\n\n      this.addMeta();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      //console.log('onFieldScope:', scope.form.key, scope);\n      let key = scope.form._key;\n      if(key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field, children = 'items') {\n      //console.log('processItems:', field, children);\n      let i = field[children].length - 1;\n      while(i > -1) {\n        let child = field[children][i];\n        let show = this.processField(child);\n        if(child.batchConfig) {\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field';\n          let batchField = this.createBatchField(child);\n          let dirtyCheck = this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: [child, dirtyCheck, batchField]\n          };\n          this.fieldRegister[child.key] = {\n            field: child\n          };\n        }\n        if(!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if(field.key) {\n        if(!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        let fieldType = cnFlexFormTypes.getFieldType(field);\n        let handler = fieldTypeHandlers[fieldType];\n\n        if(handler) {\n          if(!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          handler.bind(this)(field);\n        }\n        else return false;\n      }\n      else if(field.items) {\n        this.processItems(field);\n        if(!field.items.length) return false;\n      }\n      return true;\n    }\n\n    function createBatchField(field) {\n      let batchField = {\n        type: 'radiobuttons',\n        titleMap: field.batchConfig.titleMap,\n        key: `__batchConfig.${field.key}`,\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-small'\n      };\n\n      if(batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(field.key, '__batchConfig', {\n        type: 'string',\n        title: 'Edit Mode',\n        default: field.batchConfig.default\n      });\n\n      if(field.batchConfig.onSelect) {\n        batchField.watch = {\n          resolution: (val, prev) => {\n            field.batchConfig.onSelect[val](prev);\n          }\n        };\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      let dirtyCheck = {\n        type: 'cn-dirty-check',\n        htmlClass: (field.notitle || !field.schema.title) ? 'notitle' : '',\n        key: `__dirtyCheck.${field.key}`\n      };\n\n      this.addToSchema(field.key, '__dirtyCheck', {\n        type: 'boolean',\n        notitle: true\n      });\n\n      if(field.watch) {\n        if(!_.isArray(field.watch)) field.watch = [field.watch];\n      }\n      else {\n        field.watch = [];\n      }\n\n      field.watch.push({\n        resolution: (val, prev) => {\n          if(!angular.equals(val, prev)) {\n            let register = this.fieldRegister[field.key];\n            if(register && register.ngModel.$dirty) {\n              cnFlexFormService.parseExpression(dirtyCheck.key, this.model).set(true);\n            }\n          }\n        }\n      });\n\n      return dirtyCheck;\n    }\n\n    function addToSchema(key, start, schema) {\n      let path = sfPath.parse(key);\n      let depth = this.schema.schema.properties[start];\n\n      path.forEach((k, i) => {\n        if(i === path.length - 1) {\n          depth.properties[k] = schema;\n        }\n        else if(k === '') {\n          if(!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        }\n        else {\n          if(!depth.properties) {\n            depth.properties = {};\n          }\n          if(!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(model => {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      let models = [];\n\n      _.each(this.fieldRegister, (register, key) => {\n        let dirty = cnFlexFormService\n            .parseExpression(`__dirtyCheck.${key}`, this.model)\n            .get();\n\n        console.log('key, dirty:', key, dirty, register);\n        if(!dirty) return;\n\n        let mode = cnFlexFormService\n            .parseExpression(`__batchConfig.${key}`, this.model)\n            .get();\n\n        this.models.forEach((model, i) => {\n          if(!models[i]) models[i] = {};\n\n          let val = cnFlexFormService\n              .parseExpression(key, this.model)\n              .get();\n          let update = cnFlexFormService\n              .parseExpression(key, models[i]);\n          let original = cnFlexFormService\n              .parseExpression(key, this.models[i]);\n\n          this.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if(mode === 'replace') {\n        update.set(val);\n      }\n      else if(mode === 'append') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${originalVal} ${val.trim()}`);\n        }\n      }\n      else if(mode === 'prepend') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(val.concat(originalVal));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${val.trim()} ${originalVal}`);\n        }\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processString(field) {\n      let config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n            name: 'Replace',\n            value: 'replace'\n          }, {\n            name: 'Prepend',\n            value: 'prepend'\n          }, {\n            name: 'Append',\n            value: 'append'\n          }];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: () => {\n          if(_.uniq(config.ogValues).length === 1) {\n            field.placeholder = _.first(config.ogValues);\n          }\n          else {\n            field.placeholder = '—';\n          }\n        },\n        append: () => {\n          field.placeholder = '';\n        },\n        prepend: () => {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processSelect(field) {\n      let type = field.schema.type;\n      let config = field.batchConfig;\n\n      if(type === 'array') {\n        config.titleMap = config.titleMap || [{\n          name: 'Replace',\n          value: 'replace'\n        }, {\n          name: 'Append',\n          value: 'append'\n        }/*, {\n          name: 'Remove',\n          value: 'remove'\n        }*/];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: (prev) => {\n            if(prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          append: (prev) => {\n            if(prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          remove: () => {\n            let val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, this.model).set(val);\n          }\n        };\n      }\n      else {\n        config.titleMap = config.titleMap || [{\n          name: 'Replace',\n          value: 'replace'\n        }];\n\n        config.default = config.default || 'replace';\n\n        //if(field.titleMap && !_.chain(field.titleMap).first().isObject().value()) {\n        //  field.placeholder = _.first(config.ogValues);\n        //}\n        //if(field.schema.type === 'object') {\n        let first = _.first(config.ogValues);\n        if(_.isObject(first)) {\n          if(_.every(config.ogValues, first)) {\n            field.placeholder = first[field.displayProperty || 'name'];\n          }\n        }\n        else if(_.uniq(config.ogValues).length === 1) {\n          if(field.titleMap) {\n            first = _.find(field.titleMap, {[field.valueProperty || 'value']: first});\n          }\n          field.placeholder = first[field.displayProperty || 'name'];\n        }\n        //}\n        if(!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      let config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n            name: 'Replace',\n            value: 'replace'\n          }];\n\n      config.default = config.default || 'replace';\n\n      if(_.uniq(config.ogValues).length === 1) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      }\n      else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      let config = field.batchConfig;\n\n      config.titleMap = config.titleMap || [{\n            name: 'Replace',\n            value: 'replace'\n          }];\n\n      config.default = config.default || 'replace';\n\n      if(_.uniq(config.ogValues).length === 1) {\n\n      }\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = [];\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if(schema.type === 'object' && schema.properties) {\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      }\n      else if(schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      console.log('showResults:', results, this);\n      this.results = results;\n      this.resultsConfig = config;\n\n      $state.go('.modal', {\n        modal: 'results',\n        modalId: this.instance\n      });\n\n      this.onCloseModal = $rootScope.$on('$stateChangeStart', this.closeModal.bind(this));\n    }\n\n    function closeModal(e, toState, toParams) {\n      console.log('closeModal:', e, toState, toParams);\n      console.log('this.resultsConfig:', this.resultsConfig);\n      this.onCloseModal();\n\n      let config = this.resultsConfig;\n      if(config && config.returnState) {\n        //timeout needed so current state\n        $timeout(() => $state.go(config.returnState.name, config.returnState.params));\n      }\n\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = `\n          <div class=\"well\">\n            <h5>Edit Modes</h5>\n            <p>Some types of fields allow you to apply batch changes in\n            different ways:</p>\n            <dl>\n              <dt>Replace:</dt>\n              <dd>Replace all the original values\n              with the new value. <em>(If you don't see an <b>Edit Mode</b> option\n              for a field, this will be the default)</em></dd>\n            </dl>\n            <dl>\n              <dt>Prepend:</dt>\n              <dd>Add the new value to the start of the original\n              values for each item.</dd>\n            </dl>\n            <dl>\n              <dt>Append:</dt>\n              <dd>Affix the new value at the end of the original\n              values for each item.</dd>\n            </dl>\n          </div>`;\n    }\n  }\n\n})();","angular.module(\"cn.batch-forms\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"cn-batch-forms/batch-results.html\",\"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header cn-heading row vertical-parent\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.done()\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <ul class=\\\"list-group gutterless\\\">\\n      <li ng-repeat=\\\"result in vm.results\\\"\\n          class=\\\"list-group-item\\\"\\n          ng-class=\\\"{\\n            \\'text-danger\\': result.status != 200,\\n            \\'text-primary\\': result.status == 200\\n          }\\\">\\n        <div class=\\\"row\\\">\\n          <div class=\\\"col-sm-1 text-center\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}} ({{result.body.id}}):\\n            updated successfully\\n          </div>\\n          <div class=\\\"col-sm-11\\\"\\n               ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}} ({{vm.originals[$index].id}}):\\n            {{result.body.message}}\\n          </div>\\n        </div>\\n      </li>\\n    </ul>\\n  </div>\\n</div>\\n\");}]);"],"sourceRoot":"/source/"}