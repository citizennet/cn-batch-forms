{"version":3,"sources":["all.min.js","_.cn-batch-forms.module.js","batch-results.js","cn-batch-forms.routes.js","cn-batch-forms.service.js","templates.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","angular","module","BatchResults","$state","parent","$stateParams","activate","console","log","vm","config","idParam","results","forEach","result","i","params","_","assign","originals","id","editSref","current","name","toJson","headerConfig","title","main","actionConfig","actions","text","handler","returnState","go","noData","submit","closeModal","this","models","resultsConfig","displayName","formName","controller","$inject","cnBatchFormsConfig","cnFlexFormServiceProvider","registerField","condition","field","type","TYPE","templateUrl","TEMPLATE_URL","addTemplates","$templateCache","put","run","cnBatchForms","cnFlexFormService","cnFlexFormTypes","sfPath","$rootScope","$timeout","cnModal","augmentSchema","schema","model","length","service","BatchForms","create","constructor","addMeta","addToSchema","clearDefaults","clearSchemaDefault","createDirtyCheck","processLinks","createBatchField","getChangedModels","getEditModeLegends","getModelValues","getSchemaDefault","getTitleMap","onFieldScope","processCondition","processForm","processField","processItems","processDate","processDefault","processNumber","processSelect","processToggle","setValue","showResults","instance","instances","editModes","fieldRegister","links","forms","form","splice","$on","bind","event","scope","_key","ngModel","$pristine","children","arguments","undefined","child","show","batchConfig","htmlClass","batchField","dirtyCheck","items","replace","getSchema","properties","fieldType","getFieldType","fieldTypeHandlers","isObject","ogValues","allEqual","first","parseExpression","set","clone","uniqueId","watch","item","push","resolution","_this","map","capitalize","def","titleMap","btnClass","default","onSelect","val","prev","_this2","path","parse","notitle","isArray","equals","register","$dirty","initiated","link","_this3","fieldHandler","linkRegisters","filter","includes","linkRegister","depth","k","get","_this4","each","dirty","mode","update","original","originalVal","concat","isString","trim","_originalVal","placeholder","append","prepend","_this5","remove","chain","flatten","uniq","titleMapResolve","data","find","valueProperty","displayProperty","moment","format","onValue","undefinedClass","required","__batchConfig","__dirtyCheck","_this6","modal","close","open","controllerAs","resolve","meta","legends","decrease","increase","string","number","url","cn-autocomplete","cn-currency","cn-datetimepicker","cn-toggle","factory"],"mappings":"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","file":"all.min.js","sourcesContent":["'use strict';\n\n(function () {\n  angular.module('cn.batch-forms', ['schemaForm', 'cn.flex-form', 'cn.util', 'ui.router']);\n})();\n'use strict';\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$stateParams'];\n\n  function BatchResults($state, parent, $stateParams) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    //vm.errors = _.reject(vm.results, {status: 200});\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n    vm.formName = $state.current.name;\n\n    vm.activate = activate;\n    vm.submit = submit;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n      if (vm.config.idParam) {\n        vm.results.forEach(function (result, i) {\n          var params = _.assign({}, $stateParams, _defineProperty({}, vm.config.idParam, vm.originals[i].id));\n          result.editSref = $state.current.name + '(' + angular.toJson(params) + ')';\n          console.log('result.editSref:', result);\n        });\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Continue Editing'\n          }, {\n            text: 'Done',\n            handler: function handler() {\n              if (vm.config && vm.config.returnState) {\n                $state.go(vm.config.returnState.name, vm.config.returnState.params);\n              }\n            }\n          }]\n        },\n        noData: true\n      };\n    }\n\n    function submit(handler) {\n      console.log('submit:', handler);\n      vm.parent.closeModal();\n      if (handler) {\n        handler();\n      }\n    }\n  }\n})();\n'use strict';\n\n(function () {\n  'use strict';\n\n  angular.module('cn.batch-forms').config(cnBatchFormsConfig).run(addTemplates);\n\n  var TYPE = 'cn-dirty-check';\n  var TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = ['cnFlexFormServiceProvider'];\n\n  function cnBatchFormsConfig(cnFlexFormServiceProvider) {\n    cnFlexFormServiceProvider.registerField({\n      condition: function condition(field) {\n        return field.type === TYPE;\n      },\n      handler: function handler(field) {/*console.log('field.readonly:', field.key, field.readonly)*/},\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(TEMPLATE_URL, '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 ng-disabled=\"form.readonly\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>');\n  }\n})();\n'use strict';\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n(function () {\n  angular.module('cn.batch-forms').factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = ['cnFlexFormService', 'cnFlexFormTypes', 'sfPath', '$rootScope', '$state', '$timeout', 'cnModal'];\n  function cnBatchForms(cnFlexFormService, cnFlexFormTypes, sfPath, $rootScope, $state, $timeout, cnModal) {\n\n    var instances = 0;\n\n    var fieldTypeHandlers = {\n      'string': processDefault,\n      'number': processNumber,\n      'url': 'processDefault',\n      'cn-autocomplete': processSelect,\n      'cn-currency': processNumber,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema: augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if (!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor: constructor,\n        addMeta: addMeta,\n        addToSchema: addToSchema,\n        clearDefaults: clearDefaults,\n        clearSchemaDefault: clearSchemaDefault,\n        closeModal: closeModal,\n        createDirtyCheck: createDirtyCheck,\n        processLinks: processLinks,\n        createBatchField: createBatchField,\n        getChangedModels: getChangedModels,\n        getEditModeLegends: getEditModeLegends,\n        getModelValues: getModelValues,\n        getSchemaDefault: getSchemaDefault,\n        getTitleMap: getTitleMap,\n        onFieldScope: onFieldScope,\n        processCondition: processCondition,\n        processForm: processForm,\n        processField: processField,\n        processItems: processItems,\n        processDate: processDate,\n        processDefault: processDefault,\n        processNumber: processNumber,\n        processSelect: processSelect,\n        processToggle: processToggle,\n        setValue: setValue,\n        showResults: showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      //cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.editModes = {};\n      this.fieldRegister = {};\n      this.links = [];\n\n      this.clearDefaults();\n\n      if (schema.forms) {\n        var i = schema.forms.length - 1;\n        while (i > -1) {\n          this.processForm(schema.forms[i]);\n          if (!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      } else {\n          this.processForm(schema.form);\n        }\n\n      this.addMeta();\n      this.processLinks();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      var key = scope.form._key;\n      //console.log('onFieldScope:', key, scope.form.key, scope);\n      if (key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n      // prevent edit mode radiobuttons from setting form to dirty\n      else if (scope.form.key[0] === '__batchConfig') {\n          scope.ngModel.$pristine = false;\n        }\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field) {\n      var children = arguments.length <= 1 || arguments[1] === undefined ? 'items' : arguments[1];\n\n      //console.log('processItems:', field, children);\n      var i = field[children].length - 1;\n      while (i > -1) {\n        var child = field[children][i];\n        var show = this.processField(child);\n        if (child.batchConfig && show) {\n          //console.log('child:', child);\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field clearfix';\n          var batchField = this.createBatchField(child);\n          var dirtyCheck = child.key && this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: dirtyCheck ? [child, dirtyCheck, batchField] : [child, batchField],\n            condition: this.processCondition(child.condition)\n          };\n          delete child.condition;\n          this.fieldRegister[child.key] = {\n            field: child,\n            dirtyCheck: dirtyCheck\n          };\n        }\n        if (!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processCondition(condition) {\n      return condition && condition.replace(/\\b(model)\\.(\\S*)\\b/g, '($1.$2 === undefined ? $1.__ogValues[\"$2\"] : $1.$2)');\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if (field.key) {\n        if (!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        var fieldType = cnFlexFormTypes.getFieldType(field);\n        var handler = fieldTypeHandlers[fieldType];\n\n        if (handler) {\n          if (!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          if (_.allEqual(field.batchConfig.ogValues)) {\n            var key = '__ogValues[\"' + field.key + '\"]';\n            var first = _.first(field.batchConfig.ogValues);\n            cnFlexFormService.parseExpression(key, this.model).set(first);\n          }\n\n          handler.bind(this)(field);\n        } else return false;\n      } else if (field.items) {\n        if (field.batchConfig) {\n          field.items.forEach(function (child) {\n            child.batchConfig = _.clone(field.batchConfig);\n          });\n        }\n        this.processItems(field);\n        if (!field.items.length) return false;\n\n        if (field.batchConfig) {\n          if (!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.key = 'component_' + _.uniqueId();\n          field.batchConfig.watch = [];\n\n          field.items.forEach(function (item, i) {\n            var child = item.items[0];\n            if (!i) {\n              field.batchConfig.editModes = child.batchConfig.editModes;\n              field.batchConfig.default = child.batchConfig.default;\n            }\n            field.batchConfig.watch.push({\n              resolution: 'model.__batchConfig[\"' + child.key + '\"] = model.__batchConfig[\"' + field.batchConfig.key + '\"]'\n            });\n            item.items[2].condition = 'false';\n          });\n        }\n      }\n      return true;\n    }\n\n    function getTitleMap(editModes) {\n      var _this = this;\n\n      editModes = editModes || ['replace'];\n\n      return editModes.map(function (value) {\n        _this.editModes[value] = true;\n        return {\n          name: _.capitalize(value),\n          value: value\n        };\n      });\n    }\n\n    function getSchemaDefault(def) {\n      return def || 'replace';\n    }\n\n    function createBatchField(field) {\n      var batchConfig = field.batchConfig;\n      var key = '__batchConfig[\"' + (field.key || batchConfig.key) + '\"]';\n\n      var batchField = {\n        key: key,\n        type: 'radiobuttons',\n        titleMap: this.getTitleMap(batchConfig.editModes),\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-sm cn-no-dirty-check',\n        watch: batchConfig.watch || []\n      };\n\n      if (batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(key, {\n        type: 'string',\n        title: 'Edit Mode',\n        default: this.getSchemaDefault(batchConfig.default)\n      });\n\n      if (batchConfig.onSelect) {\n        batchField.watch.push({\n          resolution: function resolution(val, prev) {\n            if (!val) return;\n            batchConfig.onSelect[val](prev);\n          }\n        });\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      var _this2 = this;\n\n      var path = sfPath.parse(field.key);\n      var key = '__dirtyCheck[\"' + path[0] + '\"]';\n      var child = path.length > 1;\n      var htmlClass = '';\n\n      //if(child) htmlClass += ' semi-transparent';\n      if (field.notitle || !field.schema.title) htmlClass += ' notitle';\n\n      var dirtyCheck = {\n        key: key,\n        htmlClass: htmlClass,\n        type: 'cn-dirty-check'\n      };\n\n      this.addToSchema(key, {\n        type: 'boolean',\n        notitle: true\n      });\n\n      if (!child) {\n        if (field.watch) {\n          if (!_.isArray(field.watch)) field.watch = [field.watch];\n        } else {\n          field.watch = [];\n        }\n\n        field.watch.push({\n          resolution: function resolution(val, prev) {\n            if (!angular.equals(val, prev)) {\n              var register = _this2.fieldRegister[field.key];\n              if (register) {\n                if (register.ngModel && register.ngModel.$dirty || register.initiated) {\n                  //console.log('dirtyCheck.key:', dirtyCheck.key);\n                  cnFlexFormService.parseExpression(dirtyCheck.key, _this2.model).set(true);\n                } else {\n                  register.initiated = true;\n                }\n              }\n              // debug\n              else {\n                  console.log('noregister:', register);\n                }\n            }\n          }\n        });\n\n        if (field.batchConfig.link) {\n          this.links.push({\n            key: field.key,\n            links: field.batchConfig.link\n          });\n        }\n      }\n\n      return dirtyCheck;\n    }\n\n    function processLinks() {\n      var _this3 = this;\n\n      var model = this.model;\n      this.links.forEach(function (link) {\n        var fieldHandler = function fieldHandler(val, prev) {\n          if (!angular.equals(val, prev)) {\n            if (val) {\n              link.links.forEach(function (key) {\n                cnFlexFormService.parseExpression('__dirtyCheck[\"' + key + '\"]', model).set(true);\n              });\n            }\n          }\n        };\n        var fieldRegister = _this3.fieldRegister[link.key];\n        fieldRegister.field.watch.push({\n          resolution: fieldHandler\n        });\n        fieldRegister.dirtyCheck.watch = [{ resolution: fieldHandler }];\n\n        var linkRegisters = _.filter(_this3.fieldRegister, function (val, key) {\n          return link.links.includes(key);\n        });\n        linkRegisters.forEach(function (linkRegister) {\n          if (!linkRegister.dirtyCheck.watch) linkRegister.dirtyCheck.watch = [];\n          linkRegister.dirtyCheck.watch.push({\n            resolution: function resolution(val, prev) {\n              if (!angular.equals(val, prev)) {\n                if (val === false) {\n                  cnFlexFormService.parseExpression('__dirtyCheck[\"' + link.key + '\"]', model).set(false);\n                }\n              }\n            }\n          });\n        });\n      });\n    }\n\n    function addToSchema(key, schema) {\n      var path = sfPath.parse(key);\n      var depth = this.schema.schema;\n\n      path.forEach(function (k, i) {\n        if (i === path.length - 1) {\n          if (!depth.properties) {\n            depth.properties = {};\n          }\n          depth.properties[k] = schema;\n        } else if (k === '') {\n          if (!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        } else {\n          if (!depth.properties) {\n            depth.properties = {};\n          }\n          if (!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(function (model) {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      var _this4 = this;\n\n      var models = [];\n\n      _.each(this.fieldRegister, function (register, key) {\n        var dirty = cnFlexFormService.parseExpression('__dirtyCheck[\"' + key + '\"]', _this4.model).get();\n\n        if (!dirty) return;\n\n        var mode = cnFlexFormService.parseExpression('__batchConfig[\"' + key + '\"]', _this4.model).get();\n\n        _this4.models.forEach(function (model, i) {\n          if (!models[i]) models[i] = {};\n\n          var val = cnFlexFormService.parseExpression(key, _this4.model).get();\n          var update = cnFlexFormService.parseExpression(key, models[i]);\n          var original = cnFlexFormService.parseExpression(key, _this4.models[i]);\n\n          _this4.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if (mode === 'replace') {\n        update.set(val);\n      } else if (mode === 'append') {\n        var originalVal = original.get();\n        if (_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        } else if (_.isString(originalVal)) {\n          update.set(originalVal + ' ' + val.trim());\n        }\n      } else if (mode === 'prepend') {\n        var _originalVal = original.get();\n        if (_.isArray(_originalVal)) {\n          update.set(val.concat(_originalVal));\n        } else if (_.isString(_originalVal)) {\n          update.set(val.trim() + ' ' + _originalVal);\n        }\n      } else if (mode === 'increase') {\n        update.set(original.get() + val);\n      } else if (mode === 'decrease') {\n        update.set(original.get() - val);\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processDefault(field) {\n      var config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'prepend', 'append'];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: function replace() {\n          if (_.allEqual(config.ogValues)) {\n            field.placeholder = _.first(config.ogValues);\n          } else {\n            field.placeholder = '—';\n          }\n        },\n        append: function append() {\n          field.placeholder = '';\n        },\n        prepend: function prepend() {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processNumber(field) {\n      var config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'decrease', 'increase'];\n\n      if (_.allEqual(config.ogValues)) {\n        field.placeholder = _.first(config.ogValues);\n      } else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processSelect(field) {\n      var _this5 = this;\n\n      var type = field.schema.type;\n      var config = field.batchConfig;\n\n      if (type === 'array') {\n        config.editModes = config.editModes || ['replace', 'append'];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: function replace(prev) {\n            if (prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, _this5.model).set([]);\n            }\n          },\n          append: function append(prev) {\n            if (prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, _this5.model).set([]);\n            }\n          },\n          remove: function remove() {\n            var val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, _this5.model).set(val);\n          }\n        };\n      } else {\n\n        var first = _.first(config.ogValues);\n        //TODO: dynamically send back data\n        if (first && _.allEqual(config.ogValues)) {\n          var titleMap = field.titleMap || field.titleMapResolve && this.schema.data[field.titleMapResolve];\n          if (titleMap /* && !_.isObject(first)*/) {\n              first = _.find(titleMap, _defineProperty({}, field.valueProperty || 'value', first));\n            }\n          field.placeholder = first && first[field.displayProperty || 'name'];\n        }\n\n        if (!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      var config = field.batchConfig;\n\n      if (_.allEqual(config.ogValues)) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      } else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      var config = field.batchConfig;\n\n      if (_.allEqual(config.ogValues)) {\n        if (_.first(config.ogValues) == (field.onValue || true)) {\n          field.undefinedClass = 'semi-transparent';\n        } else {\n          field.undefinedClass = 'disabled semi-transparent';\n        }\n      }\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = undefined;\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if (schema.type === 'object' && schema.properties) {\n        schema.required = undefined;\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      } else if (schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      var _this6 = this;\n\n      this.results = results;\n      this.resultsConfig = config;\n\n      if (this.modal) {\n        this.modal.close();\n      }\n\n      this.modal = cnModal.open({\n        controller: 'BatchResults',\n        controllerAs: 'vm',\n        templateUrl: 'cn-batch-forms/batch-results.html',\n        resolve: {\n          parent: function parent() {\n            return _this6;\n          }\n        }\n      });\n    }\n\n    function closeModal() {\n      this.modal.close();\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = '\\n          <div class=\"well\">\\n            <h5>Edit Modes</h5>\\n            <p>Some types of fields allow you to apply batch changes in\\n            different ways:</p>\\n            <dl>\\n              <dt>Replace:</dt>\\n              <dd>Replace all the original values\\n              with the new value. <em>(If you don\\'t see an <b>Edit Mode</b> option\\n              for a field, this will be the default)</em></dd>\\n            </dl>\\n            ' + this.getEditModeLegends() + '\\n          </div>';\n    }\n\n    function getEditModeLegends() {\n      var legends = '';\n\n      if (this.editModes.prepend) {\n        legends += '\\n            <dl>\\n              <dt>Prepend:</dt>\\n              <dd>Add the new value to the start of the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.append) {\n        legends += '\\n            <dl>\\n              <dt>Append:</dt>\\n              <dd>Affix the new value at the end of the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.decrease) {\n        legends += '\\n            <dl>\\n              <dt>Decrease:</dt>\\n              <dd>Subtract the given value from the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      if (this.editModes.increase) {\n        legends += '\\n            <dl>\\n              <dt>Increase:</dt>\\n              <dd>Add the given value to the original\\n              values for each item.</dd>\\n            </dl>';\n      }\n      return legends;\n    }\n  }\n})();\n\"use strict\";\n\nangular.module(\"cn.batch-forms\").run([\"$templateCache\", function ($templateCache) {\n  $templateCache.put(\"cn-batch-forms/batch-results.html\", \"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header clearfix\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.submit(handler)\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <table class=\\\"table card-flex gutterless\\\">\\n      <tbody>\\n      <tr ng-repeat=\\\"result in vm.results\\\">\\n        <td class=\\\"col-sm-10\\\">\\n          <h6 ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}}\\n            <span class=\\\"text-mute\\\">({{result.body.id}})</span>\\n          </h6>\\n          <h6 ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}}\\n            <span class=\\\"text-mute\\\">({{vm.originals[$index].id}})</span>\\n          </h6>\\n          <p ng-class=\\\"{\\n               \\'text-danger\\': result.status != 200,\\n               \\'text-primary\\': result.status == 200\\n             }\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n            {{result.status == 200 ? \\'updated successfully\\' : result.body.message}}\\n          </p>\\n        </td>\\n        <td class=\\\"col-sm-2 text-center\\\">\\n          <a ng-show=\\\"result.editSref\\\"\\n             class=\\\"btn btn-sm btn-transparent\\\"\\n             ui-sref=\\\"{{result.editSref}}\\\">\\n            <i class=\\\"icn-edit\\\"></i>\\n          </a>\\n        </td>\\n      </tr>\\n      </tbody>\\n    </table>\\n  </div>\\n</div>\\n\");\n}]);","(function() {\n  angular.module('cn.batch-forms', [\n    'schemaForm',\n    'cn.flex-form',\n    'cn.util',\n    'ui.router'\n  ]);\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .controller('BatchResults', BatchResults);\n\n  BatchResults.$inject = ['$state', 'parent', '$stateParams'];\n\n  function BatchResults($state, parent, $stateParams) {\n\n    var vm = this;\n    vm.parent = parent;\n    vm.results = vm.parent.results;\n    //vm.errors = _.reject(vm.results, {status: 200});\n    vm.originals = vm.parent.models;\n    vm.config = vm.parent.resultsConfig;\n    vm.displayName = vm.config && vm.config.displayName || 'name';\n    vm.formName = $state.current.name;\n\n    vm.activate = activate;\n    vm.submit = submit;\n\n    vm.activate();\n\n    //////////\n\n    function activate() {\n      console.log('vm.parent:', vm.parent);\n      if(vm.config.idParam) {\n        vm.results.forEach((result, i) => {\n          let params = _.assign({}, $stateParams, {[vm.config.idParam]: vm.originals[i].id});\n          result.editSref = `${$state.current.name}(${angular.toJson(params)})`;\n          console.log('result.editSref:', result);\n        });\n      }\n\n      vm.headerConfig = {\n        title: {\n          main: 'Batch Results'\n        },\n        actionConfig: {\n          actions: [{\n            text: 'Continue Editing'\n          }, {\n            text: 'Done',\n            handler: () => {\n              if(vm.config && vm.config.returnState) {\n                $state.go(vm.config.returnState.name, vm.config.returnState.params);\n              }\n            }\n          }]\n        },\n        noData: true\n      };\n\n    }\n\n    function submit(handler) {\n      console.log('submit:', handler);\n      vm.parent.closeModal();\n      if(handler) {\n        handler();\n      }\n    }\n\n  }\n\n})();","(function() {\n  'use strict';\n\n  angular\n      .module('cn.batch-forms')\n      .config(cnBatchFormsConfig)\n      .run(addTemplates);\n\n  const TYPE = 'cn-dirty-check';\n  const TEMPLATE_URL = 'cn-batch-forms/cn-dirty-check.html';\n\n  cnBatchFormsConfig.$inject = ['cnFlexFormServiceProvider'];\n\n  function cnBatchFormsConfig(cnFlexFormServiceProvider) {\n    cnFlexFormServiceProvider.registerField({\n      condition: (field) => field.type === TYPE,\n      handler: (field) => {/*console.log('field.readonly:', field.key, field.readonly)*/},\n      type: TYPE,\n      templateUrl: TEMPLATE_URL\n    });\n  }\n\n  addTemplates.$inject = ['$templateCache'];\n  function addTemplates($templateCache) {\n    $templateCache.put(\n        TEMPLATE_URL,\n        '\\\n        <div class=\"checkbox cn-dirty-check {{form.htmlClass}}\">\\\n          <input type=\"checkbox\"\\\n                 ng-model=\"$$value$$\"\\\n                 ng-model-options=\"form.ngModelOptions\"\\\n                 sf-changed=\"form\"\\\n                 ng-disabled=\"form.readonly\"\\\n                 name=\"{{form.key.slice(-1)[0]}}\"/>\\\n        </div>'\n    );\n  }\n\n})();","(function() {\n  angular\n      .module('cn.batch-forms')\n      .factory('cnBatchForms', cnBatchForms);\n\n  cnBatchForms.$inject = [\n    'cnFlexFormService',\n    'cnFlexFormTypes',\n    'sfPath',\n    '$rootScope',\n    '$state',\n    '$timeout',\n    'cnModal'\n  ];\n  function cnBatchForms(\n      cnFlexFormService,\n      cnFlexFormTypes,\n      sfPath,\n      $rootScope,\n      $state,\n      $timeout,\n      cnModal) {\n\n    let instances = 0;\n\n    let fieldTypeHandlers = {\n      'string': processDefault,\n      'number': processNumber,\n      'url': 'processDefault',\n      'cn-autocomplete': processSelect,\n      'cn-currency': processNumber,\n      'cn-datetimepicker': processDate,\n      'cn-toggle': processToggle\n    };\n\n    return {\n      augmentSchema\n    };\n\n    //////////\n\n    function augmentSchema(schema, model, models) {\n      if(!models.length) return schema;\n\n      var service = BatchForms(schema, model, models);\n\n      return service;\n    }\n\n    function BatchForms(schema, model, models) {\n      return Object.create({\n        constructor,\n        addMeta,\n        addToSchema,\n        clearDefaults,\n        clearSchemaDefault,\n        closeModal,\n        createDirtyCheck,\n        processLinks,\n        createBatchField,\n        getChangedModels,\n        getEditModeLegends,\n        getModelValues,\n        getSchemaDefault,\n        getTitleMap,\n        onFieldScope,\n        processCondition,\n        processForm,\n        processField,\n        processItems,\n        processDate,\n        processDefault,\n        processNumber,\n        processSelect,\n        processToggle,\n        setValue,\n        showResults\n      }).constructor(schema, model, models);\n    }\n\n    function constructor(schema, model, models) {\n      console.log('BatchForms:', schema, model, models);\n\n      this.instance = instances;\n      //cnFlexFormModalLoaderService.resolveMapping('results', this.instance, this);\n      instances++;\n\n      this.schema = schema;\n      this.model = model;\n      this.models = models;\n      this.editModes = {};\n      this.fieldRegister = {};\n      this.links = [];\n\n      this.clearDefaults();\n\n      if(schema.forms) {\n        let i = schema.forms.length - 1;\n        while(i > -1) {\n          this.processForm(schema.forms[i]);\n          if(!schema.forms[i].form.length) {\n            schema.forms.splice(i, 1);\n          }\n          --i;\n        }\n        //schema.forms.forEach(this.processForm.bind(this));\n      }\n      else {\n        this.processForm(schema.form);\n      }\n\n      this.addMeta();\n      this.processLinks();\n\n      $rootScope.$on('schemaFormPropagateScope', this.onFieldScope.bind(this));\n\n      console.log('BatchDone:', schema, model, models);\n\n      return this;\n    }\n\n    function onFieldScope(event, scope) {\n      let key = scope.form._key;\n      //console.log('onFieldScope:', key, scope.form.key, scope);\n      if(key) {\n        this.fieldRegister[key].ngModel = scope.ngModel;\n      }\n      // prevent edit mode radiobuttons from setting form to dirty\n      else if(scope.form.key[0] === '__batchConfig') {\n        scope.ngModel.$pristine = false;\n      }\n\n    }\n\n    function processForm(form) {\n      this.processItems(form, 'form');\n    }\n\n    function processItems(field, children = 'items') {\n      //console.log('processItems:', field, children);\n      let i = field[children].length - 1;\n      while(i > -1) {\n        let child = field[children][i];\n        let show = this.processField(child);\n        if(child.batchConfig && show) {\n          //console.log('child:', child);\n          child.htmlClass = (child.htmlClass || '') + ' cn-batch-field clearfix';\n          let batchField = this.createBatchField(child);\n          let dirtyCheck = child.key && this.createDirtyCheck(child);\n          // add mode buttons after field\n          field[children][i] = {\n            type: 'section',\n            htmlClass: 'cn-batch-wrapper',\n            items: dirtyCheck ? [child, dirtyCheck, batchField] : [child, batchField],\n            condition: this.processCondition(child.condition)\n          };\n          delete child.condition;\n          this.fieldRegister[child.key] = {\n            field: child,\n            dirtyCheck\n          };\n        }\n        if(!show) {\n          // remove field if batch isn't supported by it or children\n          field[children].splice(i, 1);\n        }\n        --i;\n      }\n    }\n\n    function processCondition(condition) {\n      return condition && condition.replace(/\\b(model)\\.(\\S*)\\b/g, '($1.$2 === undefined ? $1.__ogValues[\"$2\"] : $1.$2)');\n    }\n\n    function processField(field) {\n      //console.log('processField:', field.batchConfig, field);\n      if(field.key) {\n        if(!field.batchConfig) return false;\n\n        field._key = field.key;\n        field.schema = field.schema || cnFlexFormService.getSchema(field.key, this.schema.schema.properties);\n        field.type = field.type || field.schema.type;\n        //field.required = false;\n\n        let fieldType = cnFlexFormTypes.getFieldType(field);\n        let handler = fieldTypeHandlers[fieldType];\n\n        if(handler) {\n          if(!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.ogValues = this.getModelValues(field);\n\n          if(_.allEqual(field.batchConfig.ogValues)) {\n            let key = `__ogValues[\"${field.key}\"]`;\n            let first = _.first(field.batchConfig.ogValues);\n            cnFlexFormService.parseExpression(key, this.model).set(first);\n          }\n\n          handler.bind(this)(field);\n        }\n        else return false;\n      }\n      else if(field.items) {\n        if(field.batchConfig) {\n          field.items.forEach(child => {\n            child.batchConfig = _.clone(field.batchConfig);\n          });\n        }\n        this.processItems(field);\n        if(!field.items.length) return false;\n\n        if(field.batchConfig) {\n          if(!_.isObject(field.batchConfig)) field.batchConfig = {};\n          field.batchConfig.key = `component_${_.uniqueId()}`;\n          field.batchConfig.watch = [];\n\n          field.items.forEach((item, i) => {\n            let child = item.items[0];\n            if(!i) {\n              field.batchConfig.editModes = child.batchConfig.editModes;\n              field.batchConfig.default = child.batchConfig.default;\n            }\n            field.batchConfig.watch.push({\n              resolution: `model.__batchConfig[\"${child.key}\"] = model.__batchConfig[\"${field.batchConfig.key}\"]`\n            });\n            item.items[2].condition = 'false';\n          });\n        }\n      }\n      return true;\n    }\n\n    function getTitleMap(editModes) {\n      editModes = editModes || ['replace'];\n\n      return editModes.map(value => {\n        this.editModes[value] = true;\n        return {\n          name: _.capitalize(value),\n          value\n        };\n      });\n    }\n\n    function getSchemaDefault(def) {\n      return def || 'replace';\n    }\n\n    function createBatchField(field) {\n      let batchConfig = field.batchConfig;\n      let key = `__batchConfig[\"${field.key || batchConfig.key}\"]`;\n\n      let batchField = {\n        key,\n        type: 'radiobuttons',\n        titleMap: this.getTitleMap(batchConfig.editModes),\n        htmlClass: 'cn-batch-options',\n        btnClass: 'btn-sm cn-no-dirty-check',\n        watch: batchConfig.watch || []\n      };\n\n      if(batchField.titleMap.length === 1) {\n        batchField.condition = 'false';\n      }\n\n      this.addToSchema(key, {\n        type: 'string',\n        title: 'Edit Mode',\n        default: this.getSchemaDefault(batchConfig.default)\n      });\n\n      if(batchConfig.onSelect) {\n        batchField.watch.push({\n          resolution: (val, prev) => {\n            if(!val) return;\n            batchConfig.onSelect[val](prev);\n          }\n        });\n      }\n\n      return batchField;\n    }\n\n    function createDirtyCheck(field) {\n      let path = sfPath.parse(field.key);\n      let key = `__dirtyCheck[\"${path[0]}\"]`;\n      let child = path.length > 1;\n      let htmlClass = '';\n\n      //if(child) htmlClass += ' semi-transparent';\n      if(field.notitle || !field.schema.title) htmlClass += ' notitle';\n\n      let dirtyCheck = {\n        key,\n        htmlClass,\n        type: 'cn-dirty-check'\n      };\n\n      this.addToSchema(key, {\n        type: 'boolean',\n        notitle: true\n      });\n\n      if(!child) {\n        if(field.watch) {\n          if(!_.isArray(field.watch)) field.watch = [field.watch];\n        }\n        else {\n          field.watch = [];\n        }\n\n        field.watch.push({\n          resolution: (val, prev) => {\n            if(!angular.equals(val, prev)) {\n              let register = this.fieldRegister[field.key];\n              if(register) {\n                if((register.ngModel && register.ngModel.$dirty) || register.initiated) {\n                  //console.log('dirtyCheck.key:', dirtyCheck.key);\n                  cnFlexFormService.parseExpression(dirtyCheck.key, this.model).set(true);\n                }\n                else {\n                  register.initiated = true;\n                }\n              }\n              // debug\n              else {\n                console.log('noregister:', register);\n              }\n            }\n          }\n        });\n\n        if (field.batchConfig.link) {\n          this.links.push({\n            key: field.key,\n            links: field.batchConfig.link\n          });\n        }\n      }\n\n      return dirtyCheck;\n    }\n\n    function processLinks() {\n      let model = this.model;\n      this.links.forEach((link) => {\n        let fieldHandler = function(val, prev) {\n          if (!angular.equals(val, prev)) {\n            if(val) {\n              link.links.forEach(key => {\n                cnFlexFormService.parseExpression(`__dirtyCheck[\"${key}\"]`, model).set(true);\n              });\n            }\n          }\n        };\n        let fieldRegister = this.fieldRegister[link.key];\n        fieldRegister.field.watch.push({\n          resolution: fieldHandler\n        });\n        fieldRegister.dirtyCheck.watch = [{resolution: fieldHandler}];\n\n        let linkRegisters = _.filter(this.fieldRegister, (val, key) => link.links.includes(key));\n        linkRegisters.forEach((linkRegister) => {\n          if (!linkRegister.dirtyCheck.watch) linkRegister.dirtyCheck.watch = [];\n          linkRegister.dirtyCheck.watch.push({\n            resolution: (val, prev) => {\n              if (!angular.equals(val, prev)) {\n                if(val === false) {\n                  cnFlexFormService.parseExpression(`__dirtyCheck[\"${link.key}\"]`, model).set(false);\n                }\n              }\n            }\n          });\n        });\n      });\n    }\n\n    function addToSchema(key, schema) {\n      let path = sfPath.parse(key);\n      let depth = this.schema.schema;\n\n      path.forEach((k, i) => {\n        if(i === path.length - 1) {\n          if(!depth.properties) {\n            depth.properties = {};\n          }\n          depth.properties[k] = schema;\n        }\n        else if(k === '') {\n          if(!depth.items) {\n            depth.items = {\n              type: 'object'\n            };\n          }\n          depth = depth.items;\n        }\n        else {\n          if(!depth.properties) {\n            depth.properties = {};\n          }\n          if(!depth.properties[k]) {\n            depth.properties[k] = {\n              type: 'object'\n            };\n          }\n          depth = depth.properties[k];\n        }\n      });\n    }\n\n    function getModelValues(field) {\n      return this.models.map(model => {\n        return cnFlexFormService.parseExpression(field.key, model).get();\n      });\n    }\n\n    function getChangedModels() {\n      let models = [];\n\n      _.each(this.fieldRegister, (register, key) => {\n        let dirty = cnFlexFormService\n            .parseExpression(`__dirtyCheck[\"${key}\"]`, this.model)\n            .get();\n\n        if(!dirty) return;\n\n        let mode = cnFlexFormService\n            .parseExpression(`__batchConfig[\"${key}\"]`, this.model)\n            .get();\n\n        this.models.forEach((model, i) => {\n          if(!models[i]) models[i] = {};\n\n          let val = cnFlexFormService\n              .parseExpression(key, this.model)\n              .get();\n          let update = cnFlexFormService\n              .parseExpression(key, models[i]);\n          let original = cnFlexFormService\n              .parseExpression(key, this.models[i]);\n\n          this.setValue(val, update, original, mode);\n        });\n      });\n\n      return models;\n    }\n\n    function setValue(val, update, original, mode) {\n      if(mode === 'replace') {\n        update.set(val);\n      }\n      else if(mode === 'append') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(originalVal.concat(val));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${originalVal} ${val.trim()}`);\n        }\n      }\n      else if(mode === 'prepend') {\n        let originalVal = original.get();\n        if(_.isArray(originalVal)) {\n          update.set(val.concat(originalVal));\n        }\n        else if(_.isString(originalVal)) {\n          update.set(`${val.trim()} ${originalVal}`);\n        }\n      }\n      else if(mode === 'increase') {\n        update.set(original.get() + val);\n      }\n      else if(mode === 'decrease') {\n        update.set(original.get() - val);\n      }\n      /* This needs work, _.find(val, item) might not work because the\n         the items we're comparing might have the same id but one might\n         have different properties\n      else if(mode === 'remove') {\n        original.get().forEach(item => {\n          if(!_.find(val, item)) {\n            update = _.reject(update, item);\n          }\n        });\n      }\n      */\n    }\n\n    function processDefault(field) {\n      let config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'prepend', 'append'];\n\n      config.default = config.default || 'append';\n\n      config.onSelect = {\n        replace: () => {\n          if(_.allEqual(config.ogValues)) {\n            field.placeholder = _.first(config.ogValues);\n          }\n          else {\n            field.placeholder = '—';\n          }\n        },\n        append: () => {\n          field.placeholder = '';\n        },\n        prepend: () => {\n          field.placeholder = '';\n        }\n      };\n    }\n\n    function processNumber(field) {\n      let config = field.batchConfig;\n\n      config.editModes = config.editModes || ['replace', 'decrease', 'increase'];\n\n      if(_.allEqual(config.ogValues)) {\n        field.placeholder = _.first(config.ogValues);\n      }\n      else {\n        field.placeholder = '—';\n      }\n    }\n\n    function  processSelect(field) {\n      let type = field.schema.type;\n      let config = field.batchConfig;\n\n      if(type === 'array') {\n        config.editModes = config.editModes || ['replace', 'append'];\n\n        config.default = config.default || 'append';\n\n        config.onSelect = {\n          replace: (prev) => {\n            if(prev !== 'append') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          append: (prev) => {\n            if(prev !== 'replace') {\n              cnFlexFormService.parseExpression(field.key, this.model).set([]);\n            }\n          },\n          remove: () => {\n            let val = _.chain(field.batchConfig.ogValues).flatten().uniq().value();\n            cnFlexFormService.parseExpression(field.key, this.model).set(val);\n          }\n        };\n      }\n      else {\n\n        let first = _.first(config.ogValues);\n        //TODO: dynamically send back data\n        if(first && _.allEqual(config.ogValues)) {\n          let titleMap = field.titleMap || (field.titleMapResolve && this.schema.data[field.titleMapResolve]);\n          if(titleMap/* && !_.isObject(first)*/) {\n            first = _.find(titleMap, {[field.valueProperty || 'value']: first});\n          }\n          field.placeholder = first && first[field.displayProperty || 'name'];\n        }\n\n        if(!field.placeholder) {\n          field.placeholder = '—';\n        }\n      }\n    }\n\n    function processDate(field) {\n      let config = field.batchConfig;\n\n      if(_.allEqual(config.ogValues)) {\n        field.placeholder = moment(_.first(config.ogValues)).format('M/DD/YYYY h:mm a');\n      }\n      else {\n        field.placeholder = '—';\n      }\n    }\n\n    function processToggle(field) {\n      let config = field.batchConfig;\n\n      if(_.allEqual(config.ogValues)) {\n        if(_.first(config.ogValues) == (field.onValue || true)) {\n          field.undefinedClass = 'semi-transparent';\n        }\n        else {\n          field.undefinedClass = 'disabled semi-transparent';\n        }\n      }\n    }\n\n    function clearDefaults() {\n      this.schema.schema.required = undefined;\n      _.each(this.schema.schema.properties, this.clearSchemaDefault.bind(this));\n\n      this.schema.schema.properties.__batchConfig = {\n        type: 'object',\n        properties: {}\n      };\n\n      this.schema.schema.properties.__dirtyCheck = {\n        type: 'object',\n        properties: {}\n      };\n    }\n\n    function clearSchemaDefault(schema) {\n      schema.default = undefined;\n      if(schema.type === 'object' && schema.properties) {\n        schema.required = undefined;\n        _.each(schema.properties, this.clearSchemaDefault.bind(this));\n      }\n      else if(schema.type === 'array' && schema.items) {\n        this.clearSchemaDefault(schema.items);\n      }\n    }\n\n    function showResults(results, config) {\n      this.results = results;\n      this.resultsConfig = config;\n\n      if(this.modal) {\n        this.modal.close();\n      }\n\n      this.modal = cnModal.open({\n        controller: 'BatchResults',\n        controllerAs: 'vm',\n        templateUrl: 'cn-batch-forms/batch-results.html',\n        resolve: {\n          parent: () => this\n        }\n      });\n    }\n\n    function closeModal() {\n      this.modal.close();\n      this.results = [];\n      this.resultsConfig = null;\n    }\n\n    function addMeta() {\n      this.schema.meta = `\n          <div class=\"well\">\n            <h5>Edit Modes</h5>\n            <p>Some types of fields allow you to apply batch changes in\n            different ways:</p>\n            <dl>\n              <dt>Replace:</dt>\n              <dd>Replace all the original values\n              with the new value. <em>(If you don't see an <b>Edit Mode</b> option\n              for a field, this will be the default)</em></dd>\n            </dl>\n            ${this.getEditModeLegends()}\n          </div>`;\n    }\n\n    function getEditModeLegends() {\n      let legends = '';\n\n      if(this.editModes.prepend) {\n        legends += `\n            <dl>\n              <dt>Prepend:</dt>\n              <dd>Add the new value to the start of the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.append) {\n        legends += `\n            <dl>\n              <dt>Append:</dt>\n              <dd>Affix the new value at the end of the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.decrease) {\n        legends += `\n            <dl>\n              <dt>Decrease:</dt>\n              <dd>Subtract the given value from the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      if(this.editModes.increase) {\n        legends += `\n            <dl>\n              <dt>Increase:</dt>\n              <dd>Add the given value to the original\n              values for each item.</dd>\n            </dl>`;\n      }\n      return legends;\n    }\n  }\n\n})();","angular.module(\"cn.batch-forms\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"cn-batch-forms/batch-results.html\",\"<div class=\\\"cn-modal\\\">\\n  <div class=\\\"modal-header clearfix\\\">\\n    <cn-flex-form-header\\n      ff-header-config=\\\"vm.headerConfig\\\"\\n      ff-submit=\\\"vm.submit(handler)\\\">\\n    </cn-flex-form-header>\\n  </div>\\n  <div class=\\\"modal-body cn-list\\\"\\n       cn-responsive-height=\\\"80\\\"\\n       cn-responsive-break=\\\"sm\\\"\\n       cn-set-max-height>\\n    <table class=\\\"table card-flex gutterless\\\">\\n      <tbody>\\n      <tr ng-repeat=\\\"result in vm.results\\\">\\n        <td class=\\\"col-sm-10\\\">\\n          <h6 ng-show=\\\"result.status == 200\\\">\\n            {{result.body[vm.displayName]}}\\n            <span class=\\\"text-mute\\\">({{result.body.id}})</span>\\n          </h6>\\n          <h6 ng-show=\\\"result.status != 200\\\">\\n            {{vm.originals[$index][vm.displayName]}}\\n            <span class=\\\"text-mute\\\">({{vm.originals[$index].id}})</span>\\n          </h6>\\n          <p ng-class=\\\"{\\n               \\'text-danger\\': result.status != 200,\\n               \\'text-primary\\': result.status == 200\\n             }\\\">\\n            <i class=\\\"fa fa-{{result.status == 200 ? \\'check\\' : \\'times\\'}}\\\"></i>\\n            {{result.status == 200 ? \\'updated successfully\\' : result.body.message}}\\n          </p>\\n        </td>\\n        <td class=\\\"col-sm-2 text-center\\\">\\n          <a ng-show=\\\"result.editSref\\\"\\n             class=\\\"btn btn-sm btn-transparent\\\"\\n             ui-sref=\\\"{{result.editSref}}\\\">\\n            <i class=\\\"icn-edit\\\"></i>\\n          </a>\\n        </td>\\n      </tr>\\n      </tbody>\\n    </table>\\n  </div>\\n</div>\\n\");}]);"],"sourceRoot":"/source/"}